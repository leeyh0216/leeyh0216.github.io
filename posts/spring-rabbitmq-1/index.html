<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8829030678254956" crossorigin="anonymous"></script><meta name="pv-proxy-endpoint" content=""><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Spring with RabbitMQ(1)" /><meta name="author" content="leeyh0216" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="Spring with RabbitMQ Pre Requirements RabbitMQ 3.6 RabbitMQ 설치(Docker) RabbitMQ를 물리 서버에 설치하기 위해서는 Erlang 설치를 선행한 후 RabbitMQ를 설치해야 하지만 테스트 용도이기 때문에 Docker로 설치 진행한다. Docker Hub의 RabbitMQ 페이지를 참고하여 설치. 이미지 Pull docker pull rabbitmq 명령어를 이용하여 이미지 다운로드. 최신 버전이 아닌 3.6 버전을 사용할 예정이므로 docker pull rabbitmq:3.6-management을 통해 pull을 진행한다.(:3.6을 붙이지 않으면 latest가 다운로드 되기 때문에 반드시 버전을 명시, management plugin을 사용하기 위해서는 버전 뒤에 -management suffix를 붙여주어야 한다) leeyh0216@leeyh0216-pc:~$ docker pull rabbitmq:3.6-management 3.6-management: Pulling from library/rabbitmq ...생략 Status: Downloaded newer image for rabbitmq:3.6-management Container 실행 docker run 명령어를 통해 RabbitMQ Container를 실행한다. hostname, port binding은 아래와 같이 구성 hostname: rabbitmq port binding: 5672:5672(rabbitmq 서버), 15672:15672(management plugin web) docker run -d --hostname rabbitmq --p 5672:5672 -p 15672:15672 --name rabbitmq rabbitmq:3.6-management 위 명령어를 실행한 후 docker ps -a를 확인해보면 정상적으로 RabbitMQ Container가 동작 중인 것을 확인할 수 있다. CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 2e27d8eb1cd3 rabbitmq:3.6-management &quot;docker-entrypoint.s…&quot; 2 minutes ago Up 2 minutes 4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, 15671/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp rabbitmq Spring Boot RabbitMQ Tutorial Spring Boot RabbitMQ 페이지를 참고하여 진행한다. build.gradle 구성 사용한 의존성은 아래와 같으며, JDK 1.8 기준으로 프로젝트를 생성한다. spring-boot-starter: 1.4.6 spring-boot-starter-web: 1.4.6 spring-boot-starter-amqp: 1.4.6 build.gradle apply plugin: &#39;java&#39; sourceCompatibility = 1.8 targetCompatibility = 1.8 repositories { mavenCentral() } dependencies { compile group: &#39;org.springframework.boot&#39;, name: &#39;spring-boot-starter&#39;, version: &#39;1.4.6.RELEASE&#39; compile group: &#39;org.springframework.boot&#39;, name: &#39;spring-boot-starter-web&#39;, version: &#39;1.4.6.RELEASE&#39; compile group: &#39;org.springframework.boot&#39;, name: &#39;spring-boot-starter-amqp&#39;, version: &#39;1.4.6.RELEASE&#39; testCompile &quot;junit:junit:4.12&quot; } 코드 구성 Spring Boot RabbitMQ Getting Started 페이지의 예제를 약간 변형하여 사용하였다. 아래 4개의 클래스를 구현한다. ReceiverConfiguration : RabbitMQ &lt;-&gt; Spring Boot 간 Connection 설정 및 Receiver 클래스에게 메시지를 전달하기 위한 Listener Container Factory 설정 Receiver : 수신한 메시지를 처리할 클래스 SampleMessage : 메시지 포맷 정의 ReceiverApplication : SpringBoot Application Entry Point ReceiverConfiguration 클래스 package com.leeyh0216.rabbitmq.receiver; import org.springframework.amqp.core.Binding; import org.springframework.amqp.core.BindingBuilder; import org.springframework.amqp.core.Queue; import org.springframework.amqp.core.TopicExchange; import org.springframework.amqp.rabbit.config.SimpleRabbitListenerContainerFactory; import org.springframework.amqp.rabbit.connection.CachingConnectionFactory; import org.springframework.amqp.rabbit.connection.ConnectionFactory; import org.springframework.amqp.support.converter.Jackson2JsonMessageConverter; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class ReceiverConfiguration { private static final String RABBITMQ_HOST = &quot;localhost&quot;; private static final int RABBITMQ_PORT = 5672; private static final String USERNAME = &quot;guest&quot;; private static final String PASSWORD = &quot;guest&quot;; private static final String ROUTING_KEY = &quot;test-topic-1.*&quot;; private static final String EXCHANGE_NAME = &quot;test-exchange-1&quot;; private static final String QUEUE_NAME = &quot;test-queue-1&quot;; /** * RabbitMQ Server와의 Connection을 생성하는 Factory 객체를 반환한다. * * @return 초기화된 RabbitMQ ConnectionFactory 객체 */ @Bean public ConnectionFactory getConnectionFactory(){ ConnectionFactory connectionFactory = new CachingConnectionFactory(RABBITMQ_HOST, RABBITMQ_PORT); ((CachingConnectionFactory) connectionFactory).setUsername(USERNAME); ((CachingConnectionFactory) connectionFactory).setPassword(PASSWORD); return connectionFactory; } /** * RabbitMQ에서 사용할 Exchange를 선언하고 반환한다. * Exchange 종류는 Topic 사용 * * @return 초기화된 TopicExchange 객체 */ @Bean public TopicExchange getExchange(){ return new TopicExchange(EXCHANGE_NAME); } /** * RabbitMQ에서 사용할 Queue를 선언하고 반환한다. * * @return 초기화된 Queue 객체 */ @Bean public Queue queue(){ return new Queue(QUEUE_NAME, true); } /** * Exchange와 Queue를 연결하는 Binding 객체를 선언하고 반환한다. * * @param queue 초기화된 Queue * @param exchange 초기화된 TopicExchange * @return Binding 객체 */ @Bean public Binding getBinding(Queue queue, TopicExchange exchange){ return BindingBuilder.bind(queue).to(exchange).with(ROUTING_KEY); } /** * RabbitMQ에서 메시지를 수신할 Listener의 Factory를 선언하고 반환한다. * * @param connectionFactory ConnectionFactory 객체 * @param converter Jackson Converter 객체. byte[] &lt;-&gt; 메시지 간 변환을 담당 * @return 초기화된 Listener Factory 객체 */ @Bean(&quot;SampleContainerFactory&quot;) SimpleRabbitListenerContainerFactory getSampleContainerFactory(ConnectionFactory connectionFactory, Jackson2JsonMessageConverter converter) { SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory(); factory.setConnectionFactory(connectionFactory); factory.setMessageConverter(converter); return factory; } @Bean public Jackson2JsonMessageConverter getMessageConverter() { return new Jackson2JsonMessageConverter(); } } RabbitMQ는 기본 설정 시 아래와 같은 연결 정보를 사용한다. Host: localhost Port: 5672 User: guest Password: guest 기본적인 함수나 객체의 의미는 주석처리하였으며, RabbitMQ 개념을 다음 글에서 정리하고, 이를 다시 Spring boot amqp 와 매핑하는 과정을 그 다음글에서 정리할 예정 Receiver 클래스 package com.leeyh0216.rabbitmq.receiver; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; @Component public class Receiver{ private static final Logger logger = LoggerFactory.getLogger(Receiver.class); /** * 메시지 수신 시 처리할 Handler 함수 * @param message RabbitMQ의 test-queue-1으로부터 수신한 메시지 */ @RabbitListener(containerFactory = &quot;SampleContainerFactory&quot;, queues=&quot;test-queue-1&quot;) public void onReceiveMessage(SampleMessage message){ logger.info(&quot;Receiver received message: {}&quot;, message); } } RabbitMQ로부터 메시지를 수신하여 처리할 Handler 함수를 포함하는 클래스이다. SampleMessage 클래스 package com.leeyh0216.rabbitmq.receiver; import com.fasterxml.jackson.databind.ObjectMapper; import java.io.Serializable; public class SampleMessage implements Serializable { private String name; private String content; public String getName() { return name; } public void setName(String name) { this.name = name; } public String getContent() { return content; } public void setContent(String content) { this.content = content; } @Override public String toString(){ try { return new ObjectMapper().writeValueAsString(this); } catch(Exception e){ System.out.println(&quot;err to parsing&quot;); return &quot;&quot;; } } } ReceiverApplication 클래스 package com.leeyh0216.rabbitmq.receiver; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.context.annotation.ComponentScan; @SpringBootApplication @ComponentScan(&quot;com.leeyh0216.rabbitmq.receiver&quot;) public class ReceiverApplication { public static void main(String[] args) throws InterruptedException { SpringApplication.run(ReceiverApplication.class, args); } } 실행해보기 Sender의 경우 구현하지 않고 일단 RabbitMQ Web Management에서 메시지를 보내보기로 했다. Application을 구동하면 아래와 같이 로그에 RabbitMQ 연결 정보와 함께 정상적으로 연결되었다는 메시지가 출력되는 것을 볼 수 있다. . ____ _ __ _ _ /\\ / ___&#39;_ __ _ _(_)_ __ __ _ \ \ \ \ ( ( )\___ | &#39;_ | &#39;_| | &#39;_ \/ _` | \ \ \ \ \\/ ___)| |_)| | | | | || (_| | ) ) ) ) &#39; |____| .__|_| |_|_| |_\__, | / / / / =========|_|==============|___/=/_/_/_/ :: Spring Boot :: (v1.4.6.RELEASE) 2018-12-30 14:27:37.088 INFO 10680 --- [cTaskExecutor-1] o.s.a.r.c.CachingConnectionFactory : Created new connection: SimpleConnection@32b38058 [delegate=amqp://guest@127.0.0.1:5672/, localPort= 50732] 2018-12-30 14:27:37.223 INFO 10680 --- [ main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http) 2018-12-30 14:27:37.230 INFO 10680 --- [ main] c.l.r.receiver.ReceiverApplication : Started ReceiverApplication in 5.807 seconds (JVM running for 6.494) 이제 RabbitMQ Web Management 페이지로 가서 메시지를 보내보도록 하자. 접속은 http://localhost:15672로 할 수 있고, 초기 사용자와 패스워드는 guest, guest이다. 아래와 같이 Exchange에 우리가 선언한 test-exchange-1 Exchange가 생성되어 있는 것을 확인할 수 있다. test-exchange-1을 클릭해보면 아래와 같이 해당 Exchange의 타입(topic)과 Binding을 확인할 수 있다. Queues 페이지를 들어가보면 우리가 선언한 test-queue-1이 생성되어 있는 것을 확인할 수 있다. test-queue-1을 클릭해보면 해당 Queue의 정보 확인, 메시지 송/수신 등 Queue에 대한 기능을 수행할 수 있다. 이제 큐에 메시지를 보내보도록 하자. 아래와 같이 Publish message 탭을 눌러 메시지를 작성한 후 전송해보자. 이 때 properties에는 아래와 같이 content_type을 application/json으로 설정해주어야 한다. 우리가 띄워놓은 Application의 로그를 확인해보면, 아래와 같이 방금 Publish한 메시지의 내용을 출력한 것을 확인할 수 있다. 2018-12-30 14:38:11.986 INFO 10680 --- [cTaskExecutor-1] c.leeyh0216.rabbitmq.receiver.Receiver : Receiver received message: {&quot;name&quot;:&quot;sample-message-1&quot;,&quot;content&quot;:&quot;hello world!&quot;}" /><meta property="og:description" content="Spring with RabbitMQ Pre Requirements RabbitMQ 3.6 RabbitMQ 설치(Docker) RabbitMQ를 물리 서버에 설치하기 위해서는 Erlang 설치를 선행한 후 RabbitMQ를 설치해야 하지만 테스트 용도이기 때문에 Docker로 설치 진행한다. Docker Hub의 RabbitMQ 페이지를 참고하여 설치. 이미지 Pull docker pull rabbitmq 명령어를 이용하여 이미지 다운로드. 최신 버전이 아닌 3.6 버전을 사용할 예정이므로 docker pull rabbitmq:3.6-management을 통해 pull을 진행한다.(:3.6을 붙이지 않으면 latest가 다운로드 되기 때문에 반드시 버전을 명시, management plugin을 사용하기 위해서는 버전 뒤에 -management suffix를 붙여주어야 한다) leeyh0216@leeyh0216-pc:~$ docker pull rabbitmq:3.6-management 3.6-management: Pulling from library/rabbitmq ...생략 Status: Downloaded newer image for rabbitmq:3.6-management Container 실행 docker run 명령어를 통해 RabbitMQ Container를 실행한다. hostname, port binding은 아래와 같이 구성 hostname: rabbitmq port binding: 5672:5672(rabbitmq 서버), 15672:15672(management plugin web) docker run -d --hostname rabbitmq --p 5672:5672 -p 15672:15672 --name rabbitmq rabbitmq:3.6-management 위 명령어를 실행한 후 docker ps -a를 확인해보면 정상적으로 RabbitMQ Container가 동작 중인 것을 확인할 수 있다. CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 2e27d8eb1cd3 rabbitmq:3.6-management &quot;docker-entrypoint.s…&quot; 2 minutes ago Up 2 minutes 4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, 15671/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp rabbitmq Spring Boot RabbitMQ Tutorial Spring Boot RabbitMQ 페이지를 참고하여 진행한다. build.gradle 구성 사용한 의존성은 아래와 같으며, JDK 1.8 기준으로 프로젝트를 생성한다. spring-boot-starter: 1.4.6 spring-boot-starter-web: 1.4.6 spring-boot-starter-amqp: 1.4.6 build.gradle apply plugin: &#39;java&#39; sourceCompatibility = 1.8 targetCompatibility = 1.8 repositories { mavenCentral() } dependencies { compile group: &#39;org.springframework.boot&#39;, name: &#39;spring-boot-starter&#39;, version: &#39;1.4.6.RELEASE&#39; compile group: &#39;org.springframework.boot&#39;, name: &#39;spring-boot-starter-web&#39;, version: &#39;1.4.6.RELEASE&#39; compile group: &#39;org.springframework.boot&#39;, name: &#39;spring-boot-starter-amqp&#39;, version: &#39;1.4.6.RELEASE&#39; testCompile &quot;junit:junit:4.12&quot; } 코드 구성 Spring Boot RabbitMQ Getting Started 페이지의 예제를 약간 변형하여 사용하였다. 아래 4개의 클래스를 구현한다. ReceiverConfiguration : RabbitMQ &lt;-&gt; Spring Boot 간 Connection 설정 및 Receiver 클래스에게 메시지를 전달하기 위한 Listener Container Factory 설정 Receiver : 수신한 메시지를 처리할 클래스 SampleMessage : 메시지 포맷 정의 ReceiverApplication : SpringBoot Application Entry Point ReceiverConfiguration 클래스 package com.leeyh0216.rabbitmq.receiver; import org.springframework.amqp.core.Binding; import org.springframework.amqp.core.BindingBuilder; import org.springframework.amqp.core.Queue; import org.springframework.amqp.core.TopicExchange; import org.springframework.amqp.rabbit.config.SimpleRabbitListenerContainerFactory; import org.springframework.amqp.rabbit.connection.CachingConnectionFactory; import org.springframework.amqp.rabbit.connection.ConnectionFactory; import org.springframework.amqp.support.converter.Jackson2JsonMessageConverter; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class ReceiverConfiguration { private static final String RABBITMQ_HOST = &quot;localhost&quot;; private static final int RABBITMQ_PORT = 5672; private static final String USERNAME = &quot;guest&quot;; private static final String PASSWORD = &quot;guest&quot;; private static final String ROUTING_KEY = &quot;test-topic-1.*&quot;; private static final String EXCHANGE_NAME = &quot;test-exchange-1&quot;; private static final String QUEUE_NAME = &quot;test-queue-1&quot;; /** * RabbitMQ Server와의 Connection을 생성하는 Factory 객체를 반환한다. * * @return 초기화된 RabbitMQ ConnectionFactory 객체 */ @Bean public ConnectionFactory getConnectionFactory(){ ConnectionFactory connectionFactory = new CachingConnectionFactory(RABBITMQ_HOST, RABBITMQ_PORT); ((CachingConnectionFactory) connectionFactory).setUsername(USERNAME); ((CachingConnectionFactory) connectionFactory).setPassword(PASSWORD); return connectionFactory; } /** * RabbitMQ에서 사용할 Exchange를 선언하고 반환한다. * Exchange 종류는 Topic 사용 * * @return 초기화된 TopicExchange 객체 */ @Bean public TopicExchange getExchange(){ return new TopicExchange(EXCHANGE_NAME); } /** * RabbitMQ에서 사용할 Queue를 선언하고 반환한다. * * @return 초기화된 Queue 객체 */ @Bean public Queue queue(){ return new Queue(QUEUE_NAME, true); } /** * Exchange와 Queue를 연결하는 Binding 객체를 선언하고 반환한다. * * @param queue 초기화된 Queue * @param exchange 초기화된 TopicExchange * @return Binding 객체 */ @Bean public Binding getBinding(Queue queue, TopicExchange exchange){ return BindingBuilder.bind(queue).to(exchange).with(ROUTING_KEY); } /** * RabbitMQ에서 메시지를 수신할 Listener의 Factory를 선언하고 반환한다. * * @param connectionFactory ConnectionFactory 객체 * @param converter Jackson Converter 객체. byte[] &lt;-&gt; 메시지 간 변환을 담당 * @return 초기화된 Listener Factory 객체 */ @Bean(&quot;SampleContainerFactory&quot;) SimpleRabbitListenerContainerFactory getSampleContainerFactory(ConnectionFactory connectionFactory, Jackson2JsonMessageConverter converter) { SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory(); factory.setConnectionFactory(connectionFactory); factory.setMessageConverter(converter); return factory; } @Bean public Jackson2JsonMessageConverter getMessageConverter() { return new Jackson2JsonMessageConverter(); } } RabbitMQ는 기본 설정 시 아래와 같은 연결 정보를 사용한다. Host: localhost Port: 5672 User: guest Password: guest 기본적인 함수나 객체의 의미는 주석처리하였으며, RabbitMQ 개념을 다음 글에서 정리하고, 이를 다시 Spring boot amqp 와 매핑하는 과정을 그 다음글에서 정리할 예정 Receiver 클래스 package com.leeyh0216.rabbitmq.receiver; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; @Component public class Receiver{ private static final Logger logger = LoggerFactory.getLogger(Receiver.class); /** * 메시지 수신 시 처리할 Handler 함수 * @param message RabbitMQ의 test-queue-1으로부터 수신한 메시지 */ @RabbitListener(containerFactory = &quot;SampleContainerFactory&quot;, queues=&quot;test-queue-1&quot;) public void onReceiveMessage(SampleMessage message){ logger.info(&quot;Receiver received message: {}&quot;, message); } } RabbitMQ로부터 메시지를 수신하여 처리할 Handler 함수를 포함하는 클래스이다. SampleMessage 클래스 package com.leeyh0216.rabbitmq.receiver; import com.fasterxml.jackson.databind.ObjectMapper; import java.io.Serializable; public class SampleMessage implements Serializable { private String name; private String content; public String getName() { return name; } public void setName(String name) { this.name = name; } public String getContent() { return content; } public void setContent(String content) { this.content = content; } @Override public String toString(){ try { return new ObjectMapper().writeValueAsString(this); } catch(Exception e){ System.out.println(&quot;err to parsing&quot;); return &quot;&quot;; } } } ReceiverApplication 클래스 package com.leeyh0216.rabbitmq.receiver; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.context.annotation.ComponentScan; @SpringBootApplication @ComponentScan(&quot;com.leeyh0216.rabbitmq.receiver&quot;) public class ReceiverApplication { public static void main(String[] args) throws InterruptedException { SpringApplication.run(ReceiverApplication.class, args); } } 실행해보기 Sender의 경우 구현하지 않고 일단 RabbitMQ Web Management에서 메시지를 보내보기로 했다. Application을 구동하면 아래와 같이 로그에 RabbitMQ 연결 정보와 함께 정상적으로 연결되었다는 메시지가 출력되는 것을 볼 수 있다. . ____ _ __ _ _ /\\ / ___&#39;_ __ _ _(_)_ __ __ _ \ \ \ \ ( ( )\___ | &#39;_ | &#39;_| | &#39;_ \/ _` | \ \ \ \ \\/ ___)| |_)| | | | | || (_| | ) ) ) ) &#39; |____| .__|_| |_|_| |_\__, | / / / / =========|_|==============|___/=/_/_/_/ :: Spring Boot :: (v1.4.6.RELEASE) 2018-12-30 14:27:37.088 INFO 10680 --- [cTaskExecutor-1] o.s.a.r.c.CachingConnectionFactory : Created new connection: SimpleConnection@32b38058 [delegate=amqp://guest@127.0.0.1:5672/, localPort= 50732] 2018-12-30 14:27:37.223 INFO 10680 --- [ main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http) 2018-12-30 14:27:37.230 INFO 10680 --- [ main] c.l.r.receiver.ReceiverApplication : Started ReceiverApplication in 5.807 seconds (JVM running for 6.494) 이제 RabbitMQ Web Management 페이지로 가서 메시지를 보내보도록 하자. 접속은 http://localhost:15672로 할 수 있고, 초기 사용자와 패스워드는 guest, guest이다. 아래와 같이 Exchange에 우리가 선언한 test-exchange-1 Exchange가 생성되어 있는 것을 확인할 수 있다. test-exchange-1을 클릭해보면 아래와 같이 해당 Exchange의 타입(topic)과 Binding을 확인할 수 있다. Queues 페이지를 들어가보면 우리가 선언한 test-queue-1이 생성되어 있는 것을 확인할 수 있다. test-queue-1을 클릭해보면 해당 Queue의 정보 확인, 메시지 송/수신 등 Queue에 대한 기능을 수행할 수 있다. 이제 큐에 메시지를 보내보도록 하자. 아래와 같이 Publish message 탭을 눌러 메시지를 작성한 후 전송해보자. 이 때 properties에는 아래와 같이 content_type을 application/json으로 설정해주어야 한다. 우리가 띄워놓은 Application의 로그를 확인해보면, 아래와 같이 방금 Publish한 메시지의 내용을 출력한 것을 확인할 수 있다. 2018-12-30 14:38:11.986 INFO 10680 --- [cTaskExecutor-1] c.leeyh0216.rabbitmq.receiver.Receiver : Receiver received message: {&quot;name&quot;:&quot;sample-message-1&quot;,&quot;content&quot;:&quot;hello world!&quot;}" /><link rel="canonical" href="https://leeyh0216.github.io/posts/spring-rabbitmq-1/" /><meta property="og:url" content="https://leeyh0216.github.io/posts/spring-rabbitmq-1/" /><meta property="og:site_name" content="leeyh0216’s devlog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-12-30T10:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Spring with RabbitMQ(1)" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@leeyh0216" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"leeyh0216"},"description":"Spring with RabbitMQ Pre Requirements RabbitMQ 3.6 RabbitMQ 설치(Docker) RabbitMQ를 물리 서버에 설치하기 위해서는 Erlang 설치를 선행한 후 RabbitMQ를 설치해야 하지만 테스트 용도이기 때문에 Docker로 설치 진행한다. Docker Hub의 RabbitMQ 페이지를 참고하여 설치. 이미지 Pull docker pull rabbitmq 명령어를 이용하여 이미지 다운로드. 최신 버전이 아닌 3.6 버전을 사용할 예정이므로 docker pull rabbitmq:3.6-management을 통해 pull을 진행한다.(:3.6을 붙이지 않으면 latest가 다운로드 되기 때문에 반드시 버전을 명시, management plugin을 사용하기 위해서는 버전 뒤에 -management suffix를 붙여주어야 한다) leeyh0216@leeyh0216-pc:~$ docker pull rabbitmq:3.6-management 3.6-management: Pulling from library/rabbitmq ...생략 Status: Downloaded newer image for rabbitmq:3.6-management Container 실행 docker run 명령어를 통해 RabbitMQ Container를 실행한다. hostname, port binding은 아래와 같이 구성 hostname: rabbitmq port binding: 5672:5672(rabbitmq 서버), 15672:15672(management plugin web) docker run -d --hostname rabbitmq --p 5672:5672 -p 15672:15672 --name rabbitmq rabbitmq:3.6-management 위 명령어를 실행한 후 docker ps -a를 확인해보면 정상적으로 RabbitMQ Container가 동작 중인 것을 확인할 수 있다. CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 2e27d8eb1cd3 rabbitmq:3.6-management &quot;docker-entrypoint.s…&quot; 2 minutes ago Up 2 minutes 4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, 15671/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp rabbitmq Spring Boot RabbitMQ Tutorial Spring Boot RabbitMQ 페이지를 참고하여 진행한다. build.gradle 구성 사용한 의존성은 아래와 같으며, JDK 1.8 기준으로 프로젝트를 생성한다. spring-boot-starter: 1.4.6 spring-boot-starter-web: 1.4.6 spring-boot-starter-amqp: 1.4.6 build.gradle apply plugin: &#39;java&#39; sourceCompatibility = 1.8 targetCompatibility = 1.8 repositories { mavenCentral() } dependencies { compile group: &#39;org.springframework.boot&#39;, name: &#39;spring-boot-starter&#39;, version: &#39;1.4.6.RELEASE&#39; compile group: &#39;org.springframework.boot&#39;, name: &#39;spring-boot-starter-web&#39;, version: &#39;1.4.6.RELEASE&#39; compile group: &#39;org.springframework.boot&#39;, name: &#39;spring-boot-starter-amqp&#39;, version: &#39;1.4.6.RELEASE&#39; testCompile &quot;junit:junit:4.12&quot; } 코드 구성 Spring Boot RabbitMQ Getting Started 페이지의 예제를 약간 변형하여 사용하였다. 아래 4개의 클래스를 구현한다. ReceiverConfiguration : RabbitMQ &lt;-&gt; Spring Boot 간 Connection 설정 및 Receiver 클래스에게 메시지를 전달하기 위한 Listener Container Factory 설정 Receiver : 수신한 메시지를 처리할 클래스 SampleMessage : 메시지 포맷 정의 ReceiverApplication : SpringBoot Application Entry Point ReceiverConfiguration 클래스 package com.leeyh0216.rabbitmq.receiver; import org.springframework.amqp.core.Binding; import org.springframework.amqp.core.BindingBuilder; import org.springframework.amqp.core.Queue; import org.springframework.amqp.core.TopicExchange; import org.springframework.amqp.rabbit.config.SimpleRabbitListenerContainerFactory; import org.springframework.amqp.rabbit.connection.CachingConnectionFactory; import org.springframework.amqp.rabbit.connection.ConnectionFactory; import org.springframework.amqp.support.converter.Jackson2JsonMessageConverter; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class ReceiverConfiguration { private static final String RABBITMQ_HOST = &quot;localhost&quot;; private static final int RABBITMQ_PORT = 5672; private static final String USERNAME = &quot;guest&quot;; private static final String PASSWORD = &quot;guest&quot;; private static final String ROUTING_KEY = &quot;test-topic-1.*&quot;; private static final String EXCHANGE_NAME = &quot;test-exchange-1&quot;; private static final String QUEUE_NAME = &quot;test-queue-1&quot;; /** * RabbitMQ Server와의 Connection을 생성하는 Factory 객체를 반환한다. * * @return 초기화된 RabbitMQ ConnectionFactory 객체 */ @Bean public ConnectionFactory getConnectionFactory(){ ConnectionFactory connectionFactory = new CachingConnectionFactory(RABBITMQ_HOST, RABBITMQ_PORT); ((CachingConnectionFactory) connectionFactory).setUsername(USERNAME); ((CachingConnectionFactory) connectionFactory).setPassword(PASSWORD); return connectionFactory; } /** * RabbitMQ에서 사용할 Exchange를 선언하고 반환한다. * Exchange 종류는 Topic 사용 * * @return 초기화된 TopicExchange 객체 */ @Bean public TopicExchange getExchange(){ return new TopicExchange(EXCHANGE_NAME); } /** * RabbitMQ에서 사용할 Queue를 선언하고 반환한다. * * @return 초기화된 Queue 객체 */ @Bean public Queue queue(){ return new Queue(QUEUE_NAME, true); } /** * Exchange와 Queue를 연결하는 Binding 객체를 선언하고 반환한다. * * @param queue 초기화된 Queue * @param exchange 초기화된 TopicExchange * @return Binding 객체 */ @Bean public Binding getBinding(Queue queue, TopicExchange exchange){ return BindingBuilder.bind(queue).to(exchange).with(ROUTING_KEY); } /** * RabbitMQ에서 메시지를 수신할 Listener의 Factory를 선언하고 반환한다. * * @param connectionFactory ConnectionFactory 객체 * @param converter Jackson Converter 객체. byte[] &lt;-&gt; 메시지 간 변환을 담당 * @return 초기화된 Listener Factory 객체 */ @Bean(&quot;SampleContainerFactory&quot;) SimpleRabbitListenerContainerFactory getSampleContainerFactory(ConnectionFactory connectionFactory, Jackson2JsonMessageConverter converter) { SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory(); factory.setConnectionFactory(connectionFactory); factory.setMessageConverter(converter); return factory; } @Bean public Jackson2JsonMessageConverter getMessageConverter() { return new Jackson2JsonMessageConverter(); } } RabbitMQ는 기본 설정 시 아래와 같은 연결 정보를 사용한다. Host: localhost Port: 5672 User: guest Password: guest 기본적인 함수나 객체의 의미는 주석처리하였으며, RabbitMQ 개념을 다음 글에서 정리하고, 이를 다시 Spring boot amqp 와 매핑하는 과정을 그 다음글에서 정리할 예정 Receiver 클래스 package com.leeyh0216.rabbitmq.receiver; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; @Component public class Receiver{ private static final Logger logger = LoggerFactory.getLogger(Receiver.class); /** * 메시지 수신 시 처리할 Handler 함수 * @param message RabbitMQ의 test-queue-1으로부터 수신한 메시지 */ @RabbitListener(containerFactory = &quot;SampleContainerFactory&quot;, queues=&quot;test-queue-1&quot;) public void onReceiveMessage(SampleMessage message){ logger.info(&quot;Receiver received message: {}&quot;, message); } } RabbitMQ로부터 메시지를 수신하여 처리할 Handler 함수를 포함하는 클래스이다. SampleMessage 클래스 package com.leeyh0216.rabbitmq.receiver; import com.fasterxml.jackson.databind.ObjectMapper; import java.io.Serializable; public class SampleMessage implements Serializable { private String name; private String content; public String getName() { return name; } public void setName(String name) { this.name = name; } public String getContent() { return content; } public void setContent(String content) { this.content = content; } @Override public String toString(){ try { return new ObjectMapper().writeValueAsString(this); } catch(Exception e){ System.out.println(&quot;err to parsing&quot;); return &quot;&quot;; } } } ReceiverApplication 클래스 package com.leeyh0216.rabbitmq.receiver; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.context.annotation.ComponentScan; @SpringBootApplication @ComponentScan(&quot;com.leeyh0216.rabbitmq.receiver&quot;) public class ReceiverApplication { public static void main(String[] args) throws InterruptedException { SpringApplication.run(ReceiverApplication.class, args); } } 실행해보기 Sender의 경우 구현하지 않고 일단 RabbitMQ Web Management에서 메시지를 보내보기로 했다. Application을 구동하면 아래와 같이 로그에 RabbitMQ 연결 정보와 함께 정상적으로 연결되었다는 메시지가 출력되는 것을 볼 수 있다. . ____ _ __ _ _ /\\\\ / ___&#39;_ __ _ _(_)_ __ __ _ \\ \\ \\ \\ ( ( )\\___ | &#39;_ | &#39;_| | &#39;_ \\/ _` | \\ \\ \\ \\ \\\\/ ___)| |_)| | | | | || (_| | ) ) ) ) &#39; |____| .__|_| |_|_| |_\\__, | / / / / =========|_|==============|___/=/_/_/_/ :: Spring Boot :: (v1.4.6.RELEASE) 2018-12-30 14:27:37.088 INFO 10680 --- [cTaskExecutor-1] o.s.a.r.c.CachingConnectionFactory : Created new connection: SimpleConnection@32b38058 [delegate=amqp://guest@127.0.0.1:5672/, localPort= 50732] 2018-12-30 14:27:37.223 INFO 10680 --- [ main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http) 2018-12-30 14:27:37.230 INFO 10680 --- [ main] c.l.r.receiver.ReceiverApplication : Started ReceiverApplication in 5.807 seconds (JVM running for 6.494) 이제 RabbitMQ Web Management 페이지로 가서 메시지를 보내보도록 하자. 접속은 http://localhost:15672로 할 수 있고, 초기 사용자와 패스워드는 guest, guest이다. 아래와 같이 Exchange에 우리가 선언한 test-exchange-1 Exchange가 생성되어 있는 것을 확인할 수 있다. test-exchange-1을 클릭해보면 아래와 같이 해당 Exchange의 타입(topic)과 Binding을 확인할 수 있다. Queues 페이지를 들어가보면 우리가 선언한 test-queue-1이 생성되어 있는 것을 확인할 수 있다. test-queue-1을 클릭해보면 해당 Queue의 정보 확인, 메시지 송/수신 등 Queue에 대한 기능을 수행할 수 있다. 이제 큐에 메시지를 보내보도록 하자. 아래와 같이 Publish message 탭을 눌러 메시지를 작성한 후 전송해보자. 이 때 properties에는 아래와 같이 content_type을 application/json으로 설정해주어야 한다. 우리가 띄워놓은 Application의 로그를 확인해보면, 아래와 같이 방금 Publish한 메시지의 내용을 출력한 것을 확인할 수 있다. 2018-12-30 14:38:11.986 INFO 10680 --- [cTaskExecutor-1] c.leeyh0216.rabbitmq.receiver.Receiver : Receiver received message: {&quot;name&quot;:&quot;sample-message-1&quot;,&quot;content&quot;:&quot;hello world!&quot;}","url":"https://leeyh0216.github.io/posts/spring-rabbitmq-1/","@type":"BlogPosting","headline":"Spring with RabbitMQ(1)","dateModified":"2018-12-30T10:00:00+09:00","datePublished":"2018-12-30T10:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://leeyh0216.github.io/posts/spring-rabbitmq-1/"},"@context":"https://schema.org"}</script><title>Spring with RabbitMQ(1) | leeyh0216's devlog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script async src="/assets/js/dist/pvreport.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-129061352-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-129061352-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">leeyh0216's devlog</a></div><div class="site-subtitle font-italic">개발/일상 블로그</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/leeyh0216" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/%EC%9A%A9%ED%99%98-%EC%9D%B4-84222a119/" aria-label="linkedin" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['leeyh0216','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Spring with RabbitMQ(1)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Spring with RabbitMQ(1)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> leeyh0216 </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Dec 30, 2018, 10:00 AM +0900" prep="on" > Dec 30, 2018 <i class="unloaded">2018-12-30T10:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1676 words">9 min</span> <span id="pv" class="pageviews"><i class="fas fa-spinner fa-spin fa-fw"></i></span></div></div><div class="post-content"><h1 id="spring-with-rabbitmq">Spring with RabbitMQ</h1><h2 id="pre-requirements">Pre Requirements</h2><ul><li>RabbitMQ 3.6</ul><h3 id="rabbitmq-설치docker">RabbitMQ 설치(Docker)</h3><p>RabbitMQ를 물리 서버에 설치하기 위해서는 Erlang 설치를 선행한 후 RabbitMQ를 설치해야 하지만 테스트 용도이기 때문에 Docker로 설치 진행한다.</p><p><a href="https://hub.docker.com/_/rabbitmq/">Docker Hub의 RabbitMQ 페이지</a>를 참고하여 설치.</p><h4 id="이미지-pull">이미지 Pull</h4><p><code class="language-plaintext highlighter-rouge">docker pull rabbitmq</code> 명령어를 이용하여 이미지 다운로드. 최신 버전이 아닌 3.6 버전을 사용할 예정이므로 <code class="language-plaintext highlighter-rouge">docker pull rabbitmq:3.6-management</code>을 통해 pull을 진행한다.(:3.6을 붙이지 않으면 latest가 다운로드 되기 때문에 반드시 버전을 명시, management plugin을 사용하기 위해서는 버전 뒤에 -management suffix를 붙여주어야 한다)</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">leeyh0216@leeyh0216-pc:~<span class="nv">$ </span>docker pull rabbitmq:3.6-management
3.6-management: Pulling from library/rabbitmq
...생략
Status: Downloaded newer image <span class="k">for </span>rabbitmq:3.6-management
 </code></pre></figure><h4 id="container-실행">Container 실행</h4><p><code class="language-plaintext highlighter-rouge">docker run</code> 명령어를 통해 RabbitMQ Container를 실행한다. hostname, port binding은 아래와 같이 구성</p><ul><li>hostname: rabbitmq<li>port binding: 5672:5672(rabbitmq 서버), 15672:15672(management plugin web)</ul><p><code class="language-plaintext highlighter-rouge">docker run -d --hostname rabbitmq --p 5672:5672 -p 15672:15672 --name rabbitmq rabbitmq:3.6-management</code></p><p>위 명령어를 실행한 후 <code class="language-plaintext highlighter-rouge">docker ps -a</code>를 확인해보면 정상적으로 RabbitMQ Container가 동작 중인 것을 확인할 수 있다.</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"> CONTAINER ID        IMAGE                     COMMAND                  CREATED             STATUS                     PORTS                                                                                        NAMES
2e27d8eb1cd3        rabbitmq:3.6-management   <span class="s2">"docker-entrypoint.s…"</span>   2 minutes ago       Up 2 minutes               4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, 15671/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp   rabbitmq</code></pre></figure><h2 id="spring-boot-rabbitmq-tutorial">Spring Boot RabbitMQ Tutorial</h2><p><a href="https://spring.io/guides/gs/messaging-rabbitmq/">Spring Boot RabbitMQ</a> 페이지를 참고하여 진행한다.</p><h3 id="buildgradle-구성">build.gradle 구성</h3><p>사용한 의존성은 아래와 같으며, JDK 1.8 기준으로 프로젝트를 생성한다.</p><ul><li>spring-boot-starter: 1.4.6<li>spring-boot-starter-web: 1.4.6<li>spring-boot-starter-amqp: 1.4.6</ul><h4 id="buildgradle">build.gradle</h4><figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'java'</span>

<span class="n">sourceCompatibility</span> <span class="o">=</span> <span class="mf">1.8</span>
<span class="n">targetCompatibility</span> <span class="o">=</span> <span class="mf">1.8</span>

<span class="n">repositories</span> <span class="o">{</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="nl">group:</span> <span class="s1">'org.springframework.boot'</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">'spring-boot-starter'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'1.4.6.RELEASE'</span>
    <span class="n">compile</span> <span class="nl">group:</span> <span class="s1">'org.springframework.boot'</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">'spring-boot-starter-web'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'1.4.6.RELEASE'</span>
    <span class="n">compile</span> <span class="nl">group:</span> <span class="s1">'org.springframework.boot'</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">'spring-boot-starter-amqp'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'1.4.6.RELEASE'</span>
    
    <span class="n">testCompile</span> <span class="s2">"junit:junit:4.12"</span>
<span class="o">}</span></code></pre></figure><h3 id="코드-구성">코드 구성</h3><p>Spring Boot RabbitMQ Getting Started 페이지의 예제를 약간 변형하여 사용하였다.</p><p>아래 4개의 클래스를 구현한다.</p><ul><li><code class="language-plaintext highlighter-rouge">ReceiverConfiguration</code> : RabbitMQ &lt;-&gt; Spring Boot 간 Connection 설정 및 Receiver 클래스에게 메시지를 전달하기 위한 Listener Container Factory 설정<li><code class="language-plaintext highlighter-rouge">Receiver</code> : 수신한 메시지를 처리할 클래스<li><code class="language-plaintext highlighter-rouge">SampleMessage</code> : 메시지 포맷 정의<li><code class="language-plaintext highlighter-rouge">ReceiverApplication</code> : SpringBoot Application Entry Point</ul><h4 id="receiverconfiguration-클래스"><code class="language-plaintext highlighter-rouge">ReceiverConfiguration</code> 클래스</h4><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.leeyh0216.rabbitmq.receiver</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Binding</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.BindingBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Queue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.TopicExchange</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.config.SimpleRabbitListenerContainerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.connection.CachingConnectionFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.connection.ConnectionFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.support.converter.Jackson2JsonMessageConverter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReceiverConfiguration</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">RABBITMQ_HOST</span> <span class="o">=</span> <span class="s">"localhost"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">RABBITMQ_PORT</span> <span class="o">=</span> <span class="mi">5672</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">USERNAME</span> <span class="o">=</span> <span class="s">"guest"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">PASSWORD</span> <span class="o">=</span> <span class="s">"guest"</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">ROUTING_KEY</span> <span class="o">=</span> <span class="s">"test-topic-1.*"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">EXCHANGE_NAME</span> <span class="o">=</span> <span class="s">"test-exchange-1"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">QUEUE_NAME</span> <span class="o">=</span> <span class="s">"test-queue-1"</span><span class="o">;</span>

    <span class="cm">/**
     * RabbitMQ Server와의 Connection을 생성하는 Factory 객체를 반환한다.
     *
     * @return 초기화된 RabbitMQ ConnectionFactory 객체
     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ConnectionFactory</span> <span class="nf">getConnectionFactory</span><span class="o">(){</span>
        <span class="nc">ConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CachingConnectionFactory</span><span class="o">(</span><span class="no">RABBITMQ_HOST</span><span class="o">,</span> <span class="no">RABBITMQ_PORT</span><span class="o">);</span>
        <span class="o">((</span><span class="nc">CachingConnectionFactory</span><span class="o">)</span> <span class="n">connectionFactory</span><span class="o">).</span><span class="na">setUsername</span><span class="o">(</span><span class="no">USERNAME</span><span class="o">);</span>
        <span class="o">((</span><span class="nc">CachingConnectionFactory</span><span class="o">)</span> <span class="n">connectionFactory</span><span class="o">).</span><span class="na">setPassword</span><span class="o">(</span><span class="no">PASSWORD</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">connectionFactory</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * RabbitMQ에서 사용할 Exchange를 선언하고 반환한다.
     * Exchange 종류는 Topic 사용
     *
     * @return 초기화된 TopicExchange 객체
     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">TopicExchange</span> <span class="nf">getExchange</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TopicExchange</span><span class="o">(</span><span class="no">EXCHANGE_NAME</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * RabbitMQ에서 사용할 Queue를 선언하고 반환한다.
     *
     * @return 초기화된 Queue 객체
     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Queue</span> <span class="nf">queue</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Queue</span><span class="o">(</span><span class="no">QUEUE_NAME</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Exchange와 Queue를 연결하는 Binding 객체를 선언하고 반환한다.
     *
     * @param queue 초기화된 Queue
     * @param exchange 초기화된 TopicExchange
     * @return Binding 객체
     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Binding</span> <span class="nf">getBinding</span><span class="o">(</span><span class="nc">Queue</span> <span class="n">queue</span><span class="o">,</span> <span class="nc">TopicExchange</span> <span class="n">exchange</span><span class="o">){</span>
        <span class="k">return</span> <span class="nc">BindingBuilder</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">queue</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="n">exchange</span><span class="o">).</span><span class="na">with</span><span class="o">(</span><span class="no">ROUTING_KEY</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * RabbitMQ에서 메시지를 수신할 Listener의 Factory를 선언하고 반환한다.
     *
     * @param connectionFactory ConnectionFactory 객체
     * @param converter Jackson Converter 객체. byte[] &lt;-&gt; 메시지 간 변환을 담당
     * @return 초기화된 Listener Factory 객체
     */</span>
    <span class="nd">@Bean</span><span class="o">(</span><span class="s">"SampleContainerFactory"</span><span class="o">)</span>
    <span class="nc">SimpleRabbitListenerContainerFactory</span> <span class="nf">getSampleContainerFactory</span><span class="o">(</span><span class="nc">ConnectionFactory</span> <span class="n">connectionFactory</span><span class="o">,</span> <span class="nc">Jackson2JsonMessageConverter</span> <span class="n">converter</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SimpleRabbitListenerContainerFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleRabbitListenerContainerFactory</span><span class="o">();</span>
        <span class="n">factory</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">connectionFactory</span><span class="o">);</span>
        <span class="n">factory</span><span class="o">.</span><span class="na">setMessageConverter</span><span class="o">(</span><span class="n">converter</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">factory</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Jackson2JsonMessageConverter</span> <span class="nf">getMessageConverter</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Jackson2JsonMessageConverter</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>RabbitMQ는 기본 설정 시 아래와 같은 연결 정보를 사용한다.</p><ul><li>Host: localhost<li>Port: 5672<li>User: guest<li>Password: guest</ul><p>기본적인 함수나 객체의 의미는 주석처리하였으며, RabbitMQ 개념을 다음 글에서 정리하고, 이를 다시 Spring boot amqp 와 매핑하는 과정을 그 다음글에서 정리할 예정</p><h4 id="receiver-클래스"><code class="language-plaintext highlighter-rouge">Receiver</code> 클래스</h4><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.leeyh0216.rabbitmq.receiver</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.annotation.RabbitListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Receiver</span><span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">Receiver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="cm">/**
     * 메시지 수신 시 처리할 Handler 함수
     * @param message RabbitMQ의 test-queue-1으로부터 수신한 메시지
     */</span>
    <span class="nd">@RabbitListener</span><span class="o">(</span><span class="n">containerFactory</span> <span class="o">=</span> <span class="s">"SampleContainerFactory"</span><span class="o">,</span> <span class="n">queues</span><span class="o">=</span><span class="s">"test-queue-1"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceiveMessage</span><span class="o">(</span><span class="nc">SampleMessage</span> <span class="n">message</span><span class="o">){</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Receiver received message: {}"</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><p>RabbitMQ로부터 메시지를 수신하여 처리할 <code class="language-plaintext highlighter-rouge">Handler</code> 함수를 포함하는 클래스이다.</p><h4 id="samplemessage-클래스"><code class="language-plaintext highlighter-rouge">SampleMessage</code> 클래스</h4><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.leeyh0216.rabbitmq.receiver</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleMessage</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="nc">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">(){</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">ObjectMapper</span><span class="o">().</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"err to parsing"</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">""</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure><h4 id="receiverapplication-클래스"><code class="language-plaintext highlighter-rouge">ReceiverApplication</code> 클래스</h4><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.leeyh0216.rabbitmq.receiver</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">"com.leeyh0216.rabbitmq.receiver"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReceiverApplication</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">ReceiverApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure><h3 id="실행해보기">실행해보기</h3><p>Sender의 경우 구현하지 않고 일단 RabbitMQ Web Management에서 메시지를 보내보기로 했다.</p><p>Application을 구동하면 아래와 같이 로그에 RabbitMQ 연결 정보와 함께 정상적으로 연결되었다는 메시지가 출력되는 것을 볼 수 있다.</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nb">.</span>   ____          _            __ _ _
 /<span class="se">\\</span> / ___<span class="s1">'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '</span>_ | <span class="s1">'_| | '</span>_ <span class="se">\/</span> _<span class="sb">`</span> | <span class="se">\ \ \ \
</span>
 <span class="se">\\</span>/  ___<span class="o">)</span>| |_<span class="o">)</span>| | | | | <span class="o">||</span> <span class="o">(</span>_| |  <span class="o">)</span> <span class="o">)</span> <span class="o">)</span> <span class="o">)</span>
  <span class="s1">'  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v1.4.6.RELEASE)
 2018-12-30 14:27:37.088  INFO 10680 --- [cTaskExecutor-1] o.s.a.r.c.CachingConnectionFactory       : Created new connection: SimpleConnection@32b38058 [delegate=amqp://guest@127.0.0.1:5672/, localPort= 50732]
2018-12-30 14:27:37.223  INFO 10680 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)
2018-12-30 14:27:37.230  INFO 10680 --- [           main] c.l.r.receiver.ReceiverApplication       : Started ReceiverApplication in 5.807 seconds (JVM running for 6.494)</span></code></pre></figure><p>이제 RabbitMQ Web Management 페이지로 가서 메시지를 보내보도록 하자. 접속은 <code class="language-plaintext highlighter-rouge">http://localhost:15672</code>로 할 수 있고, 초기 사용자와 패스워드는 <code class="language-plaintext highlighter-rouge">guest</code>, <code class="language-plaintext highlighter-rouge">guest</code>이다.</p><p>아래와 같이 Exchange에 우리가 선언한 <code class="language-plaintext highlighter-rouge">test-exchange-1</code> Exchange가 생성되어 있는 것을 확인할 수 있다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/spring/rabbitmq-webmanagement-1.jpg" alt="Exchange Overview Page" /></p><p><code class="language-plaintext highlighter-rouge">test-exchange-1</code>을 클릭해보면 아래와 같이 해당 Exchange의 타입(topic)과 Binding을 확인할 수 있다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/spring/rabbitmq-webmanagement-2.jpg" alt="Exchange Detail Page" /></p><p>Queues 페이지를 들어가보면 우리가 선언한 <code class="language-plaintext highlighter-rouge">test-queue-1</code>이 생성되어 있는 것을 확인할 수 있다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/spring/rabbitmq-webmanagement-3.jpg" alt="Queue Overview Page" /></p><p><code class="language-plaintext highlighter-rouge">test-queue-1</code>을 클릭해보면 해당 Queue의 정보 확인, 메시지 송/수신 등 Queue에 대한 기능을 수행할 수 있다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/spring/rabbitmq-webmanagement-4.jpg" alt="Queue Detail Page" /></p><p>이제 큐에 메시지를 보내보도록 하자. 아래와 같이 Publish message 탭을 눌러 메시지를 작성한 후 전송해보자. 이 때 properties에는 아래와 같이 <code class="language-plaintext highlighter-rouge">content_type</code>을 <code class="language-plaintext highlighter-rouge">application/json</code>으로 설정해주어야 한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/spring/rabbitmq-webmanagement-5.jpg" alt="Publish Message" /></p><p>우리가 띄워놓은 Application의 로그를 확인해보면, 아래와 같이 방금 Publish한 메시지의 내용을 출력한 것을 확인할 수 있다.</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">2018-12-30 14:38:11.986  INFO 10680 <span class="nt">---</span> <span class="o">[</span>cTaskExecutor-1] c.leeyh0216.rabbitmq.receiver.Receiver   : Receiver received message: <span class="o">{</span><span class="s2">"name"</span>:<span class="s2">"sample-message-1"</span>,<span class="s2">"content"</span>:<span class="s2">"hello world!"</span><span class="o">}</span></code></pre></figure></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a> <a href="/tags/rabbitmq/" class="post-tag no-text-decoration" >rabbitmq</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Spring with RabbitMQ(1) - leeyh0216's devlog&url=https://leeyh0216.github.io/posts/spring-rabbitmq-1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Spring with RabbitMQ(1) - leeyh0216's devlog&u=https://leeyh0216.github.io/posts/spring-rabbitmq-1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Spring with RabbitMQ(1) - leeyh0216's devlog&url=https://leeyh0216.github.io/posts/spring-rabbitmq-1/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">ps</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/apache-spark/">apache-spark</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/apache-druid/">apache-druid</a> <a class="post-tag" href="/tags/string/">string</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/docker/">docker</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/spring-rabbitmq-2/"><div class="card-body"> <span class="timeago small" > Dec 30, 2018 <i class="unloaded">2018-12-30T10:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring with RabbitMQ(2)</h3><div class="text-muted small"><p> Spring with RabbitMQ RabbitMQ에서 사용하는 AMQP 0-9-1 모델과 RabbitMQ의 컨셉을 정리하기 위해 작성하였다. Spring과의 자세한 매핑은 이후 글에서 작성할 예정 AMQP 0-9-1 Model High-level Overview of AMQP 0-9-1 and the AMQP Model What is...</p></div></div></a></div><div class="card"> <a href="/posts/spring-cloud-zuul/"><div class="card-body"> <span class="timeago small" > Nov 10, 2018 <i class="unloaded">2018-11-10T15:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring Cloud - Zuul(1)</h3><div class="text-muted small"><p> 개요 2017년 후반부터 2018년 초까지 팀 내 서비스들을 마이크로서비스 아키텍쳐 형태로 개발하는 프로젝트를 진행하였다. 사내에서 L7 Switch를 제공하고 있었지만, 서비스가 추가될 때마다 요청하기도 번거롭고 Software Level Gateway에서만 할 수 있는 작업들도 여럿 있었다. 당시에 Gateway 후보로 Spring Cloud...</p></div></div></a></div><div class="card"> <a href="/posts/ioc_and_di_pattern/"><div class="card-body"> <span class="timeago small" > Dec 19, 2018 <i class="unloaded">2018-12-19T10:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Inversion of Control Containers and the Dependency Injection pattern</h3><div class="text-muted small"><p> 이 글은 Martin Fowler의 Inversion of Control Containers and the Dependency Injection pattern을 요약 정리한 글입니다. Inversion of Control Containers and the Dependency Injection pattern 많은 오픈소스들은 J2EE 기술에 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/spring-core-4/" class="btn btn-outline-primary" prompt="Older"><p>Spring Core Technologies - The IoC Container(4)</p></a> <a href="/posts/spring-rabbitmq-2/" class="btn btn-outline-primary" prompt="Newer"><p>Spring with RabbitMQ(2)</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/username">leeyh0216</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ps/">ps</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/apache-spark/">apache spark</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/apache-druid/">apache druid</a> <a class="post-tag" href="/tags/string/">string</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/docker/">docker</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://leeyh0216.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
