<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8829030678254956" crossorigin="anonymous"></script><meta name="pv-proxy-endpoint" content=""><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Flink Concept - pipeline.object_reuse" /><meta name="author" content="leeyh0216" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="개요 이전 글에서 pipeline.object_reuse 옵션에 대해 설명하였다. 이 옵션을 사용하면 안되는 경우에 대해서는 Flink 공식 문서에 나와 있지 않으며, 이전 글에서도 제대로 설명하지 못했다. 이번 글에서는 언제 이 옵션을 사용하면 안되는지와 그럼에도 불구하고 옵션을 적용하고 싶은 경우 우회하는 방법에 대해 알아보도록 한다. pipeline.object_reuse를 사용하면 안되는 경우 pipeline.object_reuse를 사용하면 안되는 경우는 같은 Operator Chain에서 한 Operator의 출력에 두 개 이상의 Operator가 연결되는 경우이다. 코드는 아래와 같다. StreamExecutionEnvironment environment = StreamExecutionEnvironment.createLocalEnvironment(); environment.getConfig().enableObjectReuse(); DataStream&lt;Data&gt; input = environment.fromElements(new Data(1), new Data(2), new Data(3)).setParallelism(1); input .map(d -&gt; { d.v += 1; return d; }).setParallelism(1) .addSink(new SinkFunction&lt;Data&gt;() { @Override public void invoke(Data data, Context context) throws Exception { System.out.println(String.format(&quot;P1: %d&quot;, data.v)); } }).setParallelism(1); input .map(d -&gt; { d.v += 10; return d; }) .setParallelism(1) .addSink(new SinkFunction&lt;Data&gt;() { @Override public void invoke(Data data, Context context) throws Exception { System.out.println(String.format(&quot;P2: %d&quot;, data.v)); } }).setParallelism(1); environment.execute(); 위 코드의 출력 결과는 아래와 같다.(출력 순서나 값은 실행 환경에 따라 바뀔 수 있다) 1 2 3 4 5 6 P1: 2 P2: 12 P1: 3 P2: 13 P1: 4 P2: 14 P1의 값들은 정상적으로 1씩 증가했으나, P2의 값들은 10이 아닌 11씩 증가한 것을 볼 수 있다. Object Reuse 옵션을 적용했기 때문에 P1과 P2의 작업들이 동일한 객체에 1과 10을 각각 더했기 때문에 위와 같이 출력되는 것이다. 위의 input 객체에 연결된 Output의 타입은 CopyingBroadcastingOutputCollector이다. CopyingBroadcastingOutputCollector는 하나의 레코드를 여러 Operator에 전달할 때 사용한다. CopyingBroadcastingOutputCollector는 이전 Operator에 연결된 다수의 Operator들에게 데이터를 전달하기 위해 아래와 같은 코드를 수행한다. @Override public void collect(StreamRecord&lt;T&gt; record) { for (int i = 0; i &lt; outputs.length - 1; i++) { Output&lt;StreamRecord&lt;T&gt;&gt; output = outputs[i]; StreamRecord&lt;T&gt; shallowCopy = record.copy(record.getValue()); output.collect(shallowCopy); } ... } 같은 OperatorChain에 속하기 때문에 for문 내에서의 Output의 타입은 ChainingOutput이다(pipeline.object_reuse 옵션이 적용 되었기 때문에 CopyingChainingOutput이 아닌 ChainingOutput). ChainingOutput은 CopyingChainingOutput과 다르게 Deep Copy하지 않고 Input의 processElement를 실행한다. 이 때 StreamRecord 객체만 새로 만들 뿐 실제 값을 담고 있는 객체(record.getValue())를 사용하고, ChainingOutput에서도 별다른 복사 과정 없이 그대로 다음 Operator의 processElement를 호출해버리기 때문에 문제가 발생하는 것이다. 그래도 성능을 위해 pipeline.object_reuse를 사용하고 싶다면? 만일 위와 같은 상황이더라도 Operator가 너무 많아 복사 비용이 부담될 수 있다. 이 경우 분기가 시작되는 Operator에 disableChaining이나 rebalance를 걸면 된다. 위 두 옵션을 적용해도 1개의 Operator가 다수의 Operator에게 동일한 데이터를 전달해야 하기 때문에 CopyingBroadcastingOutputCollector를 사용한다. 다만 Output이 ChainingOutput이 아닌 ChannelSelectRecordWriter로 변경된다. ChannelSelectRecordWriter는 데이터를 다음 Operator로 넘길 때 직렬화/역직렬화 과정을 거치기 때문에 실제로는 Deep Copy가 발생하게 된다. protected void emit(T record, int targetSubpartition) throws IOException { checkErroneous(); targetPartition.emitRecord(serializeRecord(serializer, record), targetSubpartition); if (flushAlways) { targetPartition.flush(targetSubpartition); } } 위의 코드를 보면 serializeRecord를 호출하여 객체를 직렬화 하는 것을 확인할 수 있다. 정리 1개의 Operator가 2개 이상의 Operator와 연결되는 상황이 아니라면 부담없이 pipeline.object_reuse를 사용할 수 있다. 그러나 동일 OperatorChain에 속하는데 1개의 Operator가 2개 이상의 Operator와 연결되는 상황이라면 문제가 발생할 가능성이 매우 높기 때문에 해당 옵션을 사용하지 않거나 Operator Chain을 구성하지 않도록 하기를 권장한다." /><meta property="og:description" content="개요 이전 글에서 pipeline.object_reuse 옵션에 대해 설명하였다. 이 옵션을 사용하면 안되는 경우에 대해서는 Flink 공식 문서에 나와 있지 않으며, 이전 글에서도 제대로 설명하지 못했다. 이번 글에서는 언제 이 옵션을 사용하면 안되는지와 그럼에도 불구하고 옵션을 적용하고 싶은 경우 우회하는 방법에 대해 알아보도록 한다. pipeline.object_reuse를 사용하면 안되는 경우 pipeline.object_reuse를 사용하면 안되는 경우는 같은 Operator Chain에서 한 Operator의 출력에 두 개 이상의 Operator가 연결되는 경우이다. 코드는 아래와 같다. StreamExecutionEnvironment environment = StreamExecutionEnvironment.createLocalEnvironment(); environment.getConfig().enableObjectReuse(); DataStream&lt;Data&gt; input = environment.fromElements(new Data(1), new Data(2), new Data(3)).setParallelism(1); input .map(d -&gt; { d.v += 1; return d; }).setParallelism(1) .addSink(new SinkFunction&lt;Data&gt;() { @Override public void invoke(Data data, Context context) throws Exception { System.out.println(String.format(&quot;P1: %d&quot;, data.v)); } }).setParallelism(1); input .map(d -&gt; { d.v += 10; return d; }) .setParallelism(1) .addSink(new SinkFunction&lt;Data&gt;() { @Override public void invoke(Data data, Context context) throws Exception { System.out.println(String.format(&quot;P2: %d&quot;, data.v)); } }).setParallelism(1); environment.execute(); 위 코드의 출력 결과는 아래와 같다.(출력 순서나 값은 실행 환경에 따라 바뀔 수 있다) 1 2 3 4 5 6 P1: 2 P2: 12 P1: 3 P2: 13 P1: 4 P2: 14 P1의 값들은 정상적으로 1씩 증가했으나, P2의 값들은 10이 아닌 11씩 증가한 것을 볼 수 있다. Object Reuse 옵션을 적용했기 때문에 P1과 P2의 작업들이 동일한 객체에 1과 10을 각각 더했기 때문에 위와 같이 출력되는 것이다. 위의 input 객체에 연결된 Output의 타입은 CopyingBroadcastingOutputCollector이다. CopyingBroadcastingOutputCollector는 하나의 레코드를 여러 Operator에 전달할 때 사용한다. CopyingBroadcastingOutputCollector는 이전 Operator에 연결된 다수의 Operator들에게 데이터를 전달하기 위해 아래와 같은 코드를 수행한다. @Override public void collect(StreamRecord&lt;T&gt; record) { for (int i = 0; i &lt; outputs.length - 1; i++) { Output&lt;StreamRecord&lt;T&gt;&gt; output = outputs[i]; StreamRecord&lt;T&gt; shallowCopy = record.copy(record.getValue()); output.collect(shallowCopy); } ... } 같은 OperatorChain에 속하기 때문에 for문 내에서의 Output의 타입은 ChainingOutput이다(pipeline.object_reuse 옵션이 적용 되었기 때문에 CopyingChainingOutput이 아닌 ChainingOutput). ChainingOutput은 CopyingChainingOutput과 다르게 Deep Copy하지 않고 Input의 processElement를 실행한다. 이 때 StreamRecord 객체만 새로 만들 뿐 실제 값을 담고 있는 객체(record.getValue())를 사용하고, ChainingOutput에서도 별다른 복사 과정 없이 그대로 다음 Operator의 processElement를 호출해버리기 때문에 문제가 발생하는 것이다. 그래도 성능을 위해 pipeline.object_reuse를 사용하고 싶다면? 만일 위와 같은 상황이더라도 Operator가 너무 많아 복사 비용이 부담될 수 있다. 이 경우 분기가 시작되는 Operator에 disableChaining이나 rebalance를 걸면 된다. 위 두 옵션을 적용해도 1개의 Operator가 다수의 Operator에게 동일한 데이터를 전달해야 하기 때문에 CopyingBroadcastingOutputCollector를 사용한다. 다만 Output이 ChainingOutput이 아닌 ChannelSelectRecordWriter로 변경된다. ChannelSelectRecordWriter는 데이터를 다음 Operator로 넘길 때 직렬화/역직렬화 과정을 거치기 때문에 실제로는 Deep Copy가 발생하게 된다. protected void emit(T record, int targetSubpartition) throws IOException { checkErroneous(); targetPartition.emitRecord(serializeRecord(serializer, record), targetSubpartition); if (flushAlways) { targetPartition.flush(targetSubpartition); } } 위의 코드를 보면 serializeRecord를 호출하여 객체를 직렬화 하는 것을 확인할 수 있다. 정리 1개의 Operator가 2개 이상의 Operator와 연결되는 상황이 아니라면 부담없이 pipeline.object_reuse를 사용할 수 있다. 그러나 동일 OperatorChain에 속하는데 1개의 Operator가 2개 이상의 Operator와 연결되는 상황이라면 문제가 발생할 가능성이 매우 높기 때문에 해당 옵션을 사용하지 않거나 Operator Chain을 구성하지 않도록 하기를 권장한다." /><link rel="canonical" href="https://leeyh0216.github.io/posts/flink_object_reuse/" /><meta property="og:url" content="https://leeyh0216.github.io/posts/flink_object_reuse/" /><meta property="og:site_name" content="leeyh0216’s devlog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-27T00:10:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Flink Concept - pipeline.object_reuse" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@leeyh0216" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"leeyh0216"},"description":"개요 이전 글에서 pipeline.object_reuse 옵션에 대해 설명하였다. 이 옵션을 사용하면 안되는 경우에 대해서는 Flink 공식 문서에 나와 있지 않으며, 이전 글에서도 제대로 설명하지 못했다. 이번 글에서는 언제 이 옵션을 사용하면 안되는지와 그럼에도 불구하고 옵션을 적용하고 싶은 경우 우회하는 방법에 대해 알아보도록 한다. pipeline.object_reuse를 사용하면 안되는 경우 pipeline.object_reuse를 사용하면 안되는 경우는 같은 Operator Chain에서 한 Operator의 출력에 두 개 이상의 Operator가 연결되는 경우이다. 코드는 아래와 같다. StreamExecutionEnvironment environment = StreamExecutionEnvironment.createLocalEnvironment(); environment.getConfig().enableObjectReuse(); DataStream&lt;Data&gt; input = environment.fromElements(new Data(1), new Data(2), new Data(3)).setParallelism(1); input .map(d -&gt; { d.v += 1; return d; }).setParallelism(1) .addSink(new SinkFunction&lt;Data&gt;() { @Override public void invoke(Data data, Context context) throws Exception { System.out.println(String.format(&quot;P1: %d&quot;, data.v)); } }).setParallelism(1); input .map(d -&gt; { d.v += 10; return d; }) .setParallelism(1) .addSink(new SinkFunction&lt;Data&gt;() { @Override public void invoke(Data data, Context context) throws Exception { System.out.println(String.format(&quot;P2: %d&quot;, data.v)); } }).setParallelism(1); environment.execute(); 위 코드의 출력 결과는 아래와 같다.(출력 순서나 값은 실행 환경에 따라 바뀔 수 있다) 1 2 3 4 5 6 P1: 2 P2: 12 P1: 3 P2: 13 P1: 4 P2: 14 P1의 값들은 정상적으로 1씩 증가했으나, P2의 값들은 10이 아닌 11씩 증가한 것을 볼 수 있다. Object Reuse 옵션을 적용했기 때문에 P1과 P2의 작업들이 동일한 객체에 1과 10을 각각 더했기 때문에 위와 같이 출력되는 것이다. 위의 input 객체에 연결된 Output의 타입은 CopyingBroadcastingOutputCollector이다. CopyingBroadcastingOutputCollector는 하나의 레코드를 여러 Operator에 전달할 때 사용한다. CopyingBroadcastingOutputCollector는 이전 Operator에 연결된 다수의 Operator들에게 데이터를 전달하기 위해 아래와 같은 코드를 수행한다. @Override public void collect(StreamRecord&lt;T&gt; record) { for (int i = 0; i &lt; outputs.length - 1; i++) { Output&lt;StreamRecord&lt;T&gt;&gt; output = outputs[i]; StreamRecord&lt;T&gt; shallowCopy = record.copy(record.getValue()); output.collect(shallowCopy); } ... } 같은 OperatorChain에 속하기 때문에 for문 내에서의 Output의 타입은 ChainingOutput이다(pipeline.object_reuse 옵션이 적용 되었기 때문에 CopyingChainingOutput이 아닌 ChainingOutput). ChainingOutput은 CopyingChainingOutput과 다르게 Deep Copy하지 않고 Input의 processElement를 실행한다. 이 때 StreamRecord 객체만 새로 만들 뿐 실제 값을 담고 있는 객체(record.getValue())를 사용하고, ChainingOutput에서도 별다른 복사 과정 없이 그대로 다음 Operator의 processElement를 호출해버리기 때문에 문제가 발생하는 것이다. 그래도 성능을 위해 pipeline.object_reuse를 사용하고 싶다면? 만일 위와 같은 상황이더라도 Operator가 너무 많아 복사 비용이 부담될 수 있다. 이 경우 분기가 시작되는 Operator에 disableChaining이나 rebalance를 걸면 된다. 위 두 옵션을 적용해도 1개의 Operator가 다수의 Operator에게 동일한 데이터를 전달해야 하기 때문에 CopyingBroadcastingOutputCollector를 사용한다. 다만 Output이 ChainingOutput이 아닌 ChannelSelectRecordWriter로 변경된다. ChannelSelectRecordWriter는 데이터를 다음 Operator로 넘길 때 직렬화/역직렬화 과정을 거치기 때문에 실제로는 Deep Copy가 발생하게 된다. protected void emit(T record, int targetSubpartition) throws IOException { checkErroneous(); targetPartition.emitRecord(serializeRecord(serializer, record), targetSubpartition); if (flushAlways) { targetPartition.flush(targetSubpartition); } } 위의 코드를 보면 serializeRecord를 호출하여 객체를 직렬화 하는 것을 확인할 수 있다. 정리 1개의 Operator가 2개 이상의 Operator와 연결되는 상황이 아니라면 부담없이 pipeline.object_reuse를 사용할 수 있다. 그러나 동일 OperatorChain에 속하는데 1개의 Operator가 2개 이상의 Operator와 연결되는 상황이라면 문제가 발생할 가능성이 매우 높기 때문에 해당 옵션을 사용하지 않거나 Operator Chain을 구성하지 않도록 하기를 권장한다.","url":"https://leeyh0216.github.io/posts/flink_object_reuse/","@type":"BlogPosting","headline":"Flink Concept - pipeline.object_reuse","dateModified":"2021-03-27T00:10:00+09:00","datePublished":"2021-03-27T00:10:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://leeyh0216.github.io/posts/flink_object_reuse/"},"@context":"https://schema.org"}</script><title>Flink Concept - pipeline.object_reuse | leeyh0216's devlog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script async src="/assets/js/dist/pvreport.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-129061352-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-129061352-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">leeyh0216's devlog</a></div><div class="site-subtitle font-italic">개발/일상 블로그</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/leeyh0216" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/%EC%9A%A9%ED%99%98-%EC%9D%B4-84222a119/" aria-label="linkedin" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['leeyh0216','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Flink Concept - pipeline.object_reuse</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Flink Concept - pipeline.object_reuse</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> leeyh0216 </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Mar 27, 2021, 12:10 AM +0900" prep="on" > Mar 27, 2021 <i class="unloaded">2021-03-27T00:10:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="979 words">5 min</span> <span id="pv" class="pageviews"><i class="fas fa-spinner fa-spin fa-fw"></i></span></div></div><div class="post-content"><h1 id="개요">개요</h1><p><a href="https://leeyh0216.github.io/2021-03-25/flink_output">이전 글</a>에서 <code class="language-plaintext highlighter-rouge">pipeline.object_reuse</code> 옵션에 대해 설명하였다. 이 옵션을 사용하면 안되는 경우에 대해서는 Flink 공식 문서에 나와 있지 않으며, 이전 글에서도 제대로 설명하지 못했다.</p><p>이번 글에서는 언제 이 옵션을 사용하면 안되는지와 그럼에도 불구하고 옵션을 적용하고 싶은 경우 우회하는 방법에 대해 알아보도록 한다.</p><h2 id="pipelineobject_reuse를-사용하면-안되는-경우"><code class="language-plaintext highlighter-rouge">pipeline.object_reuse</code>를 사용하면 안되는 경우</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="../../assets/flink/pipe1.png" alt="Pipe 1" /></p><p><code class="language-plaintext highlighter-rouge">pipeline.object_reuse</code>를 사용하면 안되는 경우는 같은 Operator Chain에서 한 Operator의 출력에 두 개 이상의 Operator가 연결되는 경우이다. 코드는 아래와 같다.</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">StreamExecutionEnvironment</span> <span class="n">environment</span> <span class="o">=</span> <span class="nc">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">createLocalEnvironment</span><span class="o">();</span>
<span class="n">environment</span><span class="o">.</span><span class="na">getConfig</span><span class="o">().</span><span class="na">enableObjectReuse</span><span class="o">();</span>

<span class="nc">DataStream</span><span class="o">&lt;</span><span class="nc">Data</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="na">fromElements</span><span class="o">(</span><span class="k">new</span> <span class="nc">Data</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Data</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Data</span><span class="o">(</span><span class="mi">3</span><span class="o">)).</span><span class="na">setParallelism</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

<span class="n">input</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">d</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">d</span><span class="o">.</span><span class="na">v</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">d</span><span class="o">;</span>
  <span class="o">}).</span><span class="na">setParallelism</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
  <span class="o">.</span><span class="na">addSink</span><span class="o">(</span><span class="k">new</span> <span class="nc">SinkFunction</span><span class="o">&lt;</span><span class="nc">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="nc">Data</span> <span class="n">data</span><span class="o">,</span> <span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"P1: %d"</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">v</span><span class="o">));</span>
    <span class="o">}</span>
  <span class="o">}).</span><span class="na">setParallelism</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

<span class="n">input</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">d</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">d</span><span class="o">.</span><span class="na">v</span> <span class="o">+=</span> <span class="mi">10</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">d</span><span class="o">;</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">setParallelism</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
  <span class="o">.</span><span class="na">addSink</span><span class="o">(</span><span class="k">new</span> <span class="nc">SinkFunction</span><span class="o">&lt;</span><span class="nc">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="nc">Data</span> <span class="n">data</span><span class="o">,</span> <span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"P2: %d"</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">v</span><span class="o">));</span>
    <span class="o">}</span>
  <span class="o">}).</span><span class="na">setParallelism</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

<span class="n">environment</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span></code></pre></figure><p>위 코드의 출력 결과는 아래와 같다.(출력 순서나 값은 실행 환경에 따라 바뀔 수 있다)</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>P1: 2
P2: 12
P1: 3
P2: 13
P1: 4
P2: 14
</pre></table></code></div></div><p>P1의 값들은 정상적으로 1씩 증가했으나, P2의 값들은 10이 아닌 11씩 증가한 것을 볼 수 있다. Object Reuse 옵션을 적용했기 때문에 P1과 P2의 작업들이 동일한 객체에 1과 10을 각각 더했기 때문에 위와 같이 출력되는 것이다.</p><p>위의 <code class="language-plaintext highlighter-rouge">input</code> 객체에 연결된 Output의 타입은 <code class="language-plaintext highlighter-rouge">CopyingBroadcastingOutputCollector</code>이다. <code class="language-plaintext highlighter-rouge">CopyingBroadcastingOutputCollector</code>는 하나의 레코드를 여러 Operator에 전달할 때 사용한다. <code class="language-plaintext highlighter-rouge">CopyingBroadcastingOutputCollector</code>는 이전 Operator에 연결된 다수의 Operator들에게 데이터를 전달하기 위해 아래와 같은 코드를 수행한다.</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">collect</span><span class="o">(</span><span class="nc">StreamRecord</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">record</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">outputs</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="nc">Output</span><span class="o">&lt;</span><span class="nc">StreamRecord</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
    <span class="nc">StreamRecord</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">shallowCopy</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
    <span class="n">output</span><span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">shallowCopy</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>  </code></pre></figure><blockquote><p>같은 OperatorChain에 속하기 때문에 for문 내에서의 Output의 타입은 <code class="language-plaintext highlighter-rouge">ChainingOutput</code>이다(<code class="language-plaintext highlighter-rouge">pipeline.object_reuse</code> 옵션이 적용 되었기 때문에 <code class="language-plaintext highlighter-rouge">CopyingChainingOutput</code>이 아닌 <code class="language-plaintext highlighter-rouge">ChainingOutput</code>). <code class="language-plaintext highlighter-rouge">ChainingOutput</code>은 <code class="language-plaintext highlighter-rouge">CopyingChainingOutput</code>과 다르게 Deep Copy하지 않고 Input의 <code class="language-plaintext highlighter-rouge">processElement</code>를 실행한다.</p></blockquote><p>이 때 <code class="language-plaintext highlighter-rouge">StreamRecord</code> 객체만 새로 만들 뿐 실제 값을 담고 있는 객체(<code class="language-plaintext highlighter-rouge">record.getValue()</code>)를 사용하고, <code class="language-plaintext highlighter-rouge">ChainingOutput</code>에서도 별다른 복사 과정 없이 그대로 다음 Operator의 <code class="language-plaintext highlighter-rouge">processElement</code>를 호출해버리기 때문에 문제가 발생하는 것이다.</p><h2 id="그래도-성능을-위해-pipelineobject_reuse를-사용하고-싶다면">그래도 성능을 위해 <code class="language-plaintext highlighter-rouge">pipeline.object_reuse</code>를 사용하고 싶다면?</h2><p>만일 위와 같은 상황이더라도 Operator가 너무 많아 복사 비용이 부담될 수 있다. 이 경우 분기가 시작되는 <code class="language-plaintext highlighter-rouge">Operator</code>에 <code class="language-plaintext highlighter-rouge">disableChaining</code>이나 <code class="language-plaintext highlighter-rouge">rebalance</code>를 걸면 된다.</p><p>위 두 옵션을 적용해도 1개의 Operator가 다수의 Operator에게 동일한 데이터를 전달해야 하기 때문에 <code class="language-plaintext highlighter-rouge">CopyingBroadcastingOutputCollector</code>를 사용한다. 다만 Output이 <code class="language-plaintext highlighter-rouge">ChainingOutput</code>이 아닌 <code class="language-plaintext highlighter-rouge">ChannelSelectRecordWriter</code>로 변경된다. <code class="language-plaintext highlighter-rouge">ChannelSelectRecordWriter</code>는 데이터를 다음 Operator로 넘길 때 직렬화/역직렬화 과정을 거치기 때문에 실제로는 Deep Copy가 발생하게 된다.</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">emit</span><span class="o">(</span><span class="no">T</span> <span class="n">record</span><span class="o">,</span> <span class="kt">int</span> <span class="n">targetSubpartition</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
  <span class="n">checkErroneous</span><span class="o">();</span>

  <span class="n">targetPartition</span><span class="o">.</span><span class="na">emitRecord</span><span class="o">(</span><span class="n">serializeRecord</span><span class="o">(</span><span class="n">serializer</span><span class="o">,</span> <span class="n">record</span><span class="o">),</span> <span class="n">targetSubpartition</span><span class="o">);</span>

  <span class="k">if</span> <span class="o">(</span><span class="n">flushAlways</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">targetPartition</span><span class="o">.</span><span class="na">flush</span><span class="o">(</span><span class="n">targetSubpartition</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>위의 코드를 보면 <code class="language-plaintext highlighter-rouge">serializeRecord</code>를 호출하여 객체를 직렬화 하는 것을 확인할 수 있다.</p><h1 id="정리">정리</h1><p>1개의 Operator가 2개 이상의 Operator와 연결되는 상황이 아니라면 부담없이 <code class="language-plaintext highlighter-rouge">pipeline.object_reuse</code>를 사용할 수 있다. 그러나 동일 OperatorChain에 속하는데 1개의 Operator가 2개 이상의 Operator와 연결되는 상황이라면 문제가 발생할 가능성이 매우 높기 때문에 해당 옵션을 사용하지 않거나 Operator Chain을 구성하지 않도록 하기를 권장한다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/flink/'>flink</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Flink Concept - pipeline.object_reuse - leeyh0216's devlog&url=https://leeyh0216.github.io/posts/flink_object_reuse/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Flink Concept - pipeline.object_reuse - leeyh0216's devlog&u=https://leeyh0216.github.io/posts/flink_object_reuse/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Flink Concept - pipeline.object_reuse - leeyh0216's devlog&url=https://leeyh0216.github.io/posts/flink_object_reuse/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">ps</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/apache-spark/">apache-spark</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/apache-druid/">apache-druid</a> <a class="post-tag" href="/tags/string/">string</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/docker/">docker</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/flink_concepts_1/"><div class="card-body"> <span class="timeago small" > Aug 2, 2020 <i class="unloaded">2020-08-02T18:10:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Flink Concept - Operator, Task, Parallelism</h3><div class="text-muted small"><p> 개요 진행 중인 프로젝트에서 Flink를 사용할 기회가 생겼다. 처음 코드를 작성할 때는 ‘Spark과 거의 비슷하네?’ 라는 생각을 했는데, 사용하면 할 수록 다른 부분을 많이 느끼게 되어 정리 차 글을 작성한다. 아래 자료들을 참고하여 작성하였다. Apache Flink - Flink Architecture 삼성 SDS - 연산 처리...</p></div></div></a></div><div class="card"> <a href="/posts/flink_checkpoint_1/"><div class="card-body"> <span class="timeago small" > Mar 1, 2021 <i class="unloaded">2021-03-01T17:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Flink Concept - Checkpointing(1)</h3><div class="text-muted small"><p> 이 글은 Coursera - Cloud Computing Concepts, Part 1을 참고하여 작성하였습니다. 개요 스트리밍 애플리케이션은 매우 긴 시간 동안 수행되며 내부적으로 상태를 가지고 있다. 예를 들어 아래와 같이 (사용자, 페이지 체류 시간)이 입력으로 들어오고, 평균 사용자 체류 시간을 계산하는 애플리케이션이 있다고 가정하자...</p></div></div></a></div><div class="card"> <a href="/posts/flink_output/"><div class="card-body"> <span class="timeago small" > Mar 26, 2021 <i class="unloaded">2021-03-26T00:10:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Flink Concept - Operator 간 데이터 교환</h3><div class="text-muted small"><p> 개요 Flink Job의 Operator 간의 데이터 교환이 어떻게 이루어지는지 알아보고, 유의해야 할 옵션은 어떤 것이 있는지 알아보도록 한다. Flink의 Input과 Ouptut 위와 같이 3개의 Operator가 연결되어 있다고 생각해보자. 한 Operator의 출력 데이터는 다른 Operator의 입력 데이터로 사용된다. 그래프 관점...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/lead_lag_function/" class="btn btn-outline-primary" prompt="Older"><p>LEAD, LAG 함수</p></a> <a href="/posts/singleton/" class="btn btn-outline-primary" prompt="Newer"><p>싱글톤 패턴</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/username">leeyh0216</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ps/">ps</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/apache-spark/">apache spark</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/apache-druid/">apache druid</a> <a class="post-tag" href="/tags/string/">string</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/docker/">docker</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://leeyh0216.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
