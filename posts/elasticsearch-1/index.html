<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8829030678254956" crossorigin="anonymous"></script><meta name="pv-proxy-endpoint" content=""><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="ElasticSearch + MetricBeat + Kibana로 서버 모니터링하기" /><meta name="author" content="leeyh0216" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="개요 내가 근무하는 팀에서의 프로젝트는 아래와 같이 크게 두 가지로 분류된다. Hadoop Cluster에서 동작하는 배치 작업(일, 시간 단위) 위의 배치 작업의 메타데이터 및 작업 상태, 의존성 등을 관리하는 웹 서비스(WAS) Hadoop Cluster의 경우 다른 팀에서 운영을 맡고 있기 때문에 내가 작성한 프로그램이 사용하는 리소스나 코드를 최적화 시켜주면 운영 과정에서는 별다른 문제가 발생하지 않는다. 그러나 웹 서비스의 경우 동작하는 서버를 우리 팀에서 관리하기 때문에 어플리케이션 뿐만 아니라 서버, DB 또한 우리가 직접 관리해주어야 한다. 가끔 서비스에서 문제가 발생할 경우 로그 확인 뿐만 아니라 Zabbix 등을 이용하여 당시 서버의 리소스 상태를 확인하는 경우가 있는데, 정말 개괄적인 지표만을 제공하기 때문에 좀 더 세분화된 지표를 기록해야 하는 상황이 생기고 있다. Elastic Search 공식 사이트의 Getting Started With Elastic Stack 글을 보며 설치 및 실행을 테스트해보고자 한다. 설치 환경 Ubuntu 14.04 On Windows(WCL) Oracle JDK 1.8.0_181 Elastic Stack 설치 및 실행 Elastic Search 6.5.0 다운로드 ElasticSearch 다운로드 링크(Linux Tar) 를 통해 6.5.0 버전의 Elastic Search를 다운로드한다. Elastic Search tar.gz 파일 압축 풀기 tar -zxvf elasticsearch-6.5.0.tar.gz 명령어를 이용해 설치할 경로에 압축을 푼다. Elastic Search 실행 ${설치 경로}/bin/elasticsearch -d 명령어를 통해 Elastic Search를 실행(기본 옵션)한다. -d 옵션은 데몬으로 동작시킨다는 의미이다. 아래와 같이 몇몇 오류 메시지를 내뱉으며 실행되는 것을 확인할 수 있다.(몇몇 WARN 로그가 발생하지만 일단 건너뛰도록 한다) [2018-11-19T14:03:43,713][WARN ][o.e.b.JNANatives ] [unknown] unable to install syscall filter: ... 생략 [2018-11-19T14:03:57,629][INFO ][o.e.x.s.a.s.FileRolesStore] [8HVXscX] parsed [0] roles from file [/usr/lib/elasticsearch-6.5.0/config/roles.yml] [2018-11-19T14:03:58,365][INFO ][o.e.x.m.j.p.l.CppLogMessageHandler] [8HVXscX] [controller/1259] [Main.cc@109] controller (64 bit): Version 6.5.0 (Build 71882a589e5556) Copyright (c) 2018 Elasticsearch BV [2018-11-19T14:03:59,034][DEBUG][o.e.a.ActionModule ] [8HVXscX] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security [2018-11-19T14:03:59,407][INFO ][o.e.d.DiscoveryModule ] [8HVXscX] using discovery type [zen] and host providers [settings] [2018-11-19T14:04:00,676][INFO ][o.e.n.Node ] [8HVXscX] initialized [2018-11-19T14:04:00,677][INFO ][o.e.n.Node ] [8HVXscX] starting ... [2018-11-19T14:04:00,965][INFO ][o.e.t.TransportService ] [8HVXscX] publish_address {127.0.0.1:9300}, bound_addresses {[::1]:9300}, {127.0.0.1:9300} ...생략 [2018-11-19T14:04:04,245][INFO ][o.e.x.s.t.n.SecurityNetty4HttpServerTransport] [8HVXscX] publish_address {127.0.0.1:9200}, bound_addresses {[::1]:9200}, {127.0.0.1:9200} [2018-11-19T14:04:04,248][INFO ][o.e.n.Node ] [8HVXscX] started [2018-11-19T14:04:05,487][INFO ][o.e.l.LicenseService ] [8HVXscX] license [0000f9ea-9beb-4be3-a821-a81a1b65d659] mode [basic] - valid 웹 브라우저를 통해 http://localhost:9200에 접근해보면 아래와 같은 페이지가 뜨는 것을 확인할 수 있다. Kibana 설치 및 실행 Kibana 다운로드 Kibana 다운로드 링크(Linux Tar)를 통해 Kibana 6.5.0 버전을 다운로드한다. Kibana 6.5.0 tar.gz 압축 풀기 tar -zxvf kibana-6.5.0-linux-x86_64.tar.gz 명령어를 통해 압축을 푼다. Front End 모듈이 굉장히 많아서 압축을 푸는데 한세월 걸린다… Kibana 실행 ${설치경로}/bin/kibana serve 명령어를 통해 Kibana를 실행한다. 아래와 같이 로그가 찍히며 맨 아랫줄에 Server running at http://localhost:5601 과 같이 실행되었다는 것을 확인할 수 있다. log [14:48:38.563] [info][status][plugin:kibana@6.5.0] Status changed from uninitialized to green - Ready log [14:48:38.659] [info][status][plugin:elasticsearch@6.5.0] Status changed from uninitialized to yellow - Waiting for Elasticsearch ... 생략 log [14:48:53.541] [info][migrations] Creating index .kibana_1. log [14:48:55.060] [info][migrations] Pointing alias .kibana to .kibana_1. log [14:48:55.288] [info][migrations] Finished in 1747ms. log [14:48:55.292] [info][listening] Server running at http://localhost:5601 http://localhost:5601에 접속해보면 아래와 같이 Kibana의 초기 페이지가 보이는 것을 확인할 수 있다. MetricBeat 설치 및 실행 개요 ElasticSearch 에는 XXXBeat라는 제품군이 있다. Elastic Search에서는 이들을 통용하여 Beats라고 부르는데, Beats는 서버에 설치되어 서버의 운영 데이터를 Elastic Search로 전송하는(Log Stash로 전송한 뒤 Log Stash가 Elastic Search로 전송하는 방식도 있음) Agent 이다. Elastic Search에서는 아래와 같은 Beats들을 제공하고 있다. Elastic Beats To Capture Auditbeat Audit Data Filebeat Log files Heartbeat Availability Monitoring Metricbeat Metric data Packetbeat Network Traffic 서버 상태만을 모니터랑할 예정이기 때문에 일단 Metricbeat을 설치해보도록 한다. MetricBeat 다운로드 MetricBeat 다운로드 링크(Linux Tar)를 통해 MetricBeat 6.5.0 버전을 다운로드한다. MetricBeat 압축 풀기 tar -zxvf metricbeat-6.5.0-linux-x86_64.tar.gz 명령어를 통해 압축을 푼다. MetricBeat 실행 MetricBeat의 system metric 기능 활성화 MetricBeat은 몇몇 Metric 수집/전송 기능을 제공하는데, 이 예제에서는 system metric 수집 및 전송 기능을 테스트한다. ${설치경로}/bin/metricbeat modules enable system 명령어를 통해 system metric module을 활성화한다. MetricBeat Setup MetricBeat과 연결된 Kibana의 Dashboard를 초기화하는 과정이다. ${설치경로}/bin/metricbeat setup -e 명령어를 통해 초기화 할 수 있다. 아래와 같은 로그 메시지가 발생하며 초기화되었다고 성공 메시지로 명령어가 종료된다. 2018-11-19T23:55:19.747+0900 INFO instance/beat.go:616 Home path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Config path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Data path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/data] Logs path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/logs] 2018-11-19T23:55:19.766+0900 INFO instance/beat.go:623 Beat UUID: d4c0cd03-35c3-4c65-b51d-222021e17837 2018-11-19T23:55:19.769+0900 INFO [beat] instance/beat.go:849 Beat info {&quot;system_info&quot;: {&quot;beat&quot;: {&quot;path&quot;: {&quot;config&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;data&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/data&quot;, &quot;home&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;logs&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/logs&quot;}, &quot;type&quot;: &quot;metricbeat&quot;, &quot;uuid&quot;: &quot;d4c0cd03-35c3-4c65-b51d-222021e17837&quot;}}} ... 생략 2018-11-19T23:55:19.826+0900 INFO instance/beat.go:302 Setup Beat: metricbeat; Version: 6.5.0 2018-11-19T23:55:22.836+0900 INFO add_cloud_metadata/add_cloud_metadata.go:319 add_cloud_metadata: hosting provider type not detected. 2018-11-19T23:55:22.885+0900 INFO elasticsearch/client.go:163 Elasticsearch url: http://localhost:9200 2018-11-19T23:55:22.898+0900 INFO [publisher] pipeline/module.go:110 Beat name: leeyh0216-pc 2018-11-19T23:55:22.903+0900 INFO elasticsearch/client.go:163 Elasticsearch url: http://localhost:9200 2018-11-19T23:55:22.917+0900 INFO elasticsearch/client.go:712 Connected to Elasticsearch version 6.5.0 2018-11-19T23:55:22.933+0900 INFO template/load.go:129 Template already exists and will not be overwritten. Loaded index template Loading dashboards (Kibana must be running and reachable) 2018-11-19T23:55:22.938+0900 INFO elasticsearch/client.go:163 Elasticsearch url: http://localhost:9200 2018-11-19T23:55:22.962+0900 INFO elasticsearch/client.go:712 Connected to Elasticsearch version 6.5.0 2018-11-19T23:55:22.967+0900 INFO kibana/client.go:118 Kibana url: http://localhost:5601 2018-11-19T23:55:57.005+0900 INFO instance/beat.go:741 Kibana dashboards successfully loaded. MetricBeat 서비스 실행 위의 두 과정을 통해 MetricBeat의 System 모듈과 MetricBeat과 연결된 Kibana의 Dashboard를 초기화하였다. 이제 MetricBeat을 실행할 차례이다. 아래 명령어를 통해 MetricBeat을 실행한다. ${설치경로}/bin/metricbeat -e 명령어를 입력하면 아래와 같은 로그 메시지가 발생하며 MetricBeat이 실행된 것을 확인할 수 있다. 2018-11-19T23:57:08.793+0900 INFO instance/beat.go:616 Home path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Config path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Data path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/data] Logs path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/logs] 2018-11-19T23:57:08.796+0900 INFO instance/beat.go:623 Beat UUID: d4c0cd03-35c3-4c65-b51d-222021e17837 2018-11-19T23:57:08.799+0900 INFO [seccomp] seccomp/seccomp.go:93 Syscall filter could not be installed because the kernel does not support seccomp 2018-11-19T23:57:08.816+0900 INFO [beat] instance/beat.go:849 Beat info {&quot;system_info&quot;: {&quot;beat&quot;: {&quot;path&quot;: {&quot;config&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;data&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/data&quot;, &quot;home&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;logs&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/logs&quot;}, &quot;type&quot;: &quot;metricbeat&quot;, &quot;uuid&quot;: &quot;d4c0cd03-35c3-4c65-b51d-222021e17837&quot;}}} 2018-11-19T23:57:08.817+0900 INFO [beat] instance/beat.go:858 Build info {&quot;system_info&quot;: {&quot;build&quot;: {&quot;commit&quot;: &quot;ff5b9b3db49856a25b5eda133b6997f2157a4910&quot;, &quot;libbeat&quot;: &quot;6.5.0&quot;, &quot;time&quot;: &quot;2018-11-09T18:03:04.000Z&quot;, &quot;version&quot;: &quot;6.5.0&quot;}}} 2018-11-19T23:57:08.818+0900 INFO [beat] instance/beat.go:861 Go runtime info {&quot;system_info&quot;: {&quot;go&quot;: {&quot;os&quot;:&quot;linux&quot;,&quot;arch&quot;:&quot;amd64&quot;,&quot;max_procs&quot;:4,&quot;version&quot;:&quot;go1.10.3&quot;}}} 2018-11-19T23:57:08.824+0900 INFO [beat] instance/beat.go:865 Host info {&quot;system_info&quot;: {&quot;host&quot;: {&quot;architecture&quot;:&quot;x86_64&quot;,&quot;boot_time&quot;:&quot;2018-11-16T22:41:58+09:00&quot;,&quot;containerized&quot;:true,&quot;name&quot;:&quot;leeyh0216-pc&quot;,&quot;ip&quot;:[&quot;169.254.103.52/16&quot;,&quot;fe80::35ce:4940:4154:6734/64&quot;,&quot;169.254.182.173/16&quot;,&quot;fe80::8595:86d3:ab93:b6ad/64&quot;,&quot;172.22.36.145/28&quot;,&quot;fe80::e0b9:fff1:14a:3de5/64&quot;,&quot;10.0.75.1/24&quot;,&quot;127.0.0.1/8&quot;,&quot;::1/128&quot;,&quot;192.168.219.103/24&quot;,&quot;fe80::f571:57f5:e305:e4ec/64&quot;,&quot;169.254.39.125/16&quot;,&quot;fe80::64b2:28fe:35ae:277d/64&quot;,&quot;169.254.189.130/16&quot;,&quot;fe80::fd70:9829:96ad:bd82/64&quot;],&quot;kernel_version&quot;:&quot;4.4.0-17134-Microsoft&quot;,&quot;mac&quot;:[&quot;c4:9d:ed:8e:1f:7c&quot;,&quot;02:50:f2:00:00:01&quot;,&quot;02:15:06:8b:5d:5c&quot;,&quot;00:15:5d:db:85:04&quot;,&quot;c4:9d:ed:8e:1f:7b&quot;,&quot;c6:9d:ed:8e:1e:7a&quot;,&quot;c6:9d:ed:8e:1b:7a&quot;],&quot;os&quot;:{&quot;family&quot;:&quot;debian&quot;,&quot;platform&quot;:&quot;ubuntu&quot;,&quot;name&quot;:&quot;Ubuntu&quot;,&quot;version&quot;:&quot;16.04.3 LTS (Xenial Xerus)&quot;,&quot;major&quot;:16,&quot;minor&quot;:4,&quot;patch&quot;:3,&quot;codename&quot;:&quot;xenial&quot;},&quot;timezone&quot;:&quot;DST&quot;,&quot;timezone_offset_sec&quot;:32400}}} 2018-11-19T23:57:08.826+0900 INFO [beat] instance/beat.go:894 Process info {&quot;system_info&quot;: {&quot;process&quot;: {&quot;capabilities&quot;: {&quot;inheritable&quot;:null,&quot;permitted&quot;:null,&quot;effective&quot;:null,&quot;bounding&quot;:[&quot;chown&quot;,&quot;dac_override&quot;,&quot;dac_read_search&quot;,&quot;fowner&quot;,&quot;fsetid&quot;,&quot;kill&quot;,&quot;setgid&quot;,&quot;setuid&quot;,&quot;setpcap&quot;,&quot;linux_immutable&quot;,&quot;net_bind_service&quot;,&quot;net_broadcast&quot;,&quot;net_admin&quot;,&quot;net_raw&quot;,&quot;ipc_lock&quot;,&quot;ipc_owner&quot;,&quot;sys_module&quot;,&quot;sys_rawio&quot;,&quot;sys_chroot&quot;,&quot;sys_ptrace&quot;,&quot;sys_pacct&quot;,&quot;sys_admin&quot;,&quot;sys_boot&quot;,&quot;sys_nice&quot;,&quot;sys_resource&quot;,&quot;sys_time&quot;,&quot;sys_tty_config&quot;,&quot;mknod&quot;,&quot;lease&quot;,&quot;audit_write&quot;,&quot;audit_control&quot;,&quot;setfcap&quot;,&quot;mac_override&quot;,&quot;mac_admin&quot;,&quot;syslog&quot;,&quot;wake_alarm&quot;,&quot;block_suspend&quot;],&quot;ambient&quot;:null}, &quot;cwd&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;exe&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/metricbeat&quot;, &quot;name&quot;: &quot;metricbeat&quot;, &quot;pid&quot;: 1790, &quot;ppid&quot;: 1641, &quot;seccomp&quot;: {&quot;mode&quot;:&quot;&quot;}, &quot;start_time&quot;: &quot;2018-11-19T23:57:07.900+0900&quot;}}} 2018-11-19T23:57:08.827+0900 INFO instance/beat.go:302 Setup Beat: metricbeat; Version: 6.5.0 2018-11-19T23:57:11.839+0900 INFO add_cloud_metadata/add_cloud_metadata.go:319 add_cloud_metadata: hosting provider type not detected. 2018-11-19T23:57:11.845+0900 INFO elasticsearch/client.go:163 Elasticsearch url: http://localhost:9200 2018-11-19T23:57:11.871+0900 INFO [publisher] pipeline/module.go:110 Beat name: leeyh0216-pc 2018-11-19T23:57:11.909+0900 INFO [monitoring] log/log.go:117 Starting metrics logging every 30s 2018-11-19T23:57:11.911+0900 INFO instance/beat.go:424 metricbeat start running. ...생략 2018-11-19T23:57:13.116+0900 INFO template/load.go:129 Template already exists and will not be overwritten. 2018-11-19T23:57:13.118+0900 INFO pipeline/output.go:105 Connection to backoff(elasticsearch(http://localhost:9200)) established 2018-11-19T23:57:41.953+0900 INFO [monitoring] log/log.go:144 Non-zero metrics in the last 30s {&quot;monitoring&quot;: {&quot;metrics&quot;: {&quot;beat&quot;:{&quot;cpu&quot;:{&quot;system&quot;:{&quot;ticks&quot;:480,&quot;time&quot;:{&quot;ms&quot;:484}},&quot;total&quot;:{&quot;ticks&quot;:680,&quot;time&quot;:{&quot;ms&quot;:687},&quot;value&quot;:0},&quot;user&quot;:{&quot;ticks&quot;:200,&quot;time&quot;:{&quot;ms&quot;:203}}},&quot;handles&quot;:{&quot;limit&quot;:{&quot;hard&quot;:4096,&quot;soft&quot;:1024},&quot;open&quot;:6},&quot;info&quot;:{&quot;ephemeral_id&quot;:&quot;f91190da-ef4b-4bcd-9cc3-9b84419376fa&quot;,&quot;uptime&quot;:{&quot;ms&quot;:33233}},&quot;memstats&quot;:{&quot;gc_next&quot;:6331744,&quot;memory_alloc&quot;:5023160,&quot;memory_total&quot;:17274296,&quot;rss&quot;:25976832}},&quot;libbeat&quot;:{&quot;config&quot;:{&quot;module&quot;:{&quot;running&quot;:0},&quot;reloads&quot;:1},&quot;output&quot;:{&quot;events&quot;:{&quot;acked&quot;:62,&quot;batches&quot;:3,&quot;total&quot;:62},&quot;read&quot;:{&quot;bytes&quot;:1902},&quot;type&quot;:&quot;elasticsearch&quot;,&quot;write&quot;:{&quot;bytes&quot;:45366}},&quot;pipeline&quot;:{&quot;clients&quot;:6,&quot;events&quot;:{&quot;active&quot;:0,&quot;published&quot;:62,&quot;retry&quot;:24,&quot;total&quot;:62},&quot;queue&quot;:{&quot;acked&quot;:62}}},&quot;metricbeat&quot;:{&quot;system&quot;:{&quot;cpu&quot;:{&quot;events&quot;:3,&quot;success&quot;:3},&quot;filesystem&quot;:{&quot;events&quot;:1,&quot;failures&quot;:1},&quot;fsstat&quot;:{&quot;events&quot;:1,&quot;failures&quot;:1},&quot;load&quot;:{&quot;events&quot;:3,&quot;success&quot;:3},&quot;memory&quot;:{&quot;events&quot;:3,&quot;success&quot;:3},&quot;network&quot;:{&quot;events&quot;:24,&quot;success&quot;:24},&quot;process&quot;:{&quot;events&quot;:23,&quot;success&quot;:23},&quot;process_summary&quot;:{&quot;events&quot;:3,&quot;success&quot;:3},&quot;uptime&quot;:{&quot;events&quot;:1,&quot;success&quot;:1}}},&quot;system&quot;:{&quot;cpu&quot;:{&quot;cores&quot;:4},&quot;load&quot;:{&quot;1&quot;:0.52,&quot;15&quot;:0.59,&quot;5&quot;:0.58,&quot;norm&quot;:{&quot;1&quot;:0.13,&quot;15&quot;:0.1475,&quot;5&quot;:0.145}}}}}} 일정 시간마다 맨 아랫줄과 같은 시스템 정보를 Elastic Search로 전송하는 것을 확인할 수 있다. Kibana의 Dashboard 메뉴를 클릭해보면 아래와 같이 여러 개의 Dashboard가 생성된 것을 확인할 수 있으며 System Dashboard로 들어가보면 아래와 같이 System 상태가 기록되는 것을 확인할 수 있다. 정리 다운로드/설치만을 통해 기본 값으로 실행해서 그런지 막힘 없이 진행할 수 있었다. 대시보드의 지표들을 확인해보니 확실히 Zabbix 보다 많은 기능을 제공해주는 것 같긴 하다. 좀 더 기능적인 부분에 대해 확인해본 후 도입을 결정해야할 것 같다." /><meta property="og:description" content="개요 내가 근무하는 팀에서의 프로젝트는 아래와 같이 크게 두 가지로 분류된다. Hadoop Cluster에서 동작하는 배치 작업(일, 시간 단위) 위의 배치 작업의 메타데이터 및 작업 상태, 의존성 등을 관리하는 웹 서비스(WAS) Hadoop Cluster의 경우 다른 팀에서 운영을 맡고 있기 때문에 내가 작성한 프로그램이 사용하는 리소스나 코드를 최적화 시켜주면 운영 과정에서는 별다른 문제가 발생하지 않는다. 그러나 웹 서비스의 경우 동작하는 서버를 우리 팀에서 관리하기 때문에 어플리케이션 뿐만 아니라 서버, DB 또한 우리가 직접 관리해주어야 한다. 가끔 서비스에서 문제가 발생할 경우 로그 확인 뿐만 아니라 Zabbix 등을 이용하여 당시 서버의 리소스 상태를 확인하는 경우가 있는데, 정말 개괄적인 지표만을 제공하기 때문에 좀 더 세분화된 지표를 기록해야 하는 상황이 생기고 있다. Elastic Search 공식 사이트의 Getting Started With Elastic Stack 글을 보며 설치 및 실행을 테스트해보고자 한다. 설치 환경 Ubuntu 14.04 On Windows(WCL) Oracle JDK 1.8.0_181 Elastic Stack 설치 및 실행 Elastic Search 6.5.0 다운로드 ElasticSearch 다운로드 링크(Linux Tar) 를 통해 6.5.0 버전의 Elastic Search를 다운로드한다. Elastic Search tar.gz 파일 압축 풀기 tar -zxvf elasticsearch-6.5.0.tar.gz 명령어를 이용해 설치할 경로에 압축을 푼다. Elastic Search 실행 ${설치 경로}/bin/elasticsearch -d 명령어를 통해 Elastic Search를 실행(기본 옵션)한다. -d 옵션은 데몬으로 동작시킨다는 의미이다. 아래와 같이 몇몇 오류 메시지를 내뱉으며 실행되는 것을 확인할 수 있다.(몇몇 WARN 로그가 발생하지만 일단 건너뛰도록 한다) [2018-11-19T14:03:43,713][WARN ][o.e.b.JNANatives ] [unknown] unable to install syscall filter: ... 생략 [2018-11-19T14:03:57,629][INFO ][o.e.x.s.a.s.FileRolesStore] [8HVXscX] parsed [0] roles from file [/usr/lib/elasticsearch-6.5.0/config/roles.yml] [2018-11-19T14:03:58,365][INFO ][o.e.x.m.j.p.l.CppLogMessageHandler] [8HVXscX] [controller/1259] [Main.cc@109] controller (64 bit): Version 6.5.0 (Build 71882a589e5556) Copyright (c) 2018 Elasticsearch BV [2018-11-19T14:03:59,034][DEBUG][o.e.a.ActionModule ] [8HVXscX] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security [2018-11-19T14:03:59,407][INFO ][o.e.d.DiscoveryModule ] [8HVXscX] using discovery type [zen] and host providers [settings] [2018-11-19T14:04:00,676][INFO ][o.e.n.Node ] [8HVXscX] initialized [2018-11-19T14:04:00,677][INFO ][o.e.n.Node ] [8HVXscX] starting ... [2018-11-19T14:04:00,965][INFO ][o.e.t.TransportService ] [8HVXscX] publish_address {127.0.0.1:9300}, bound_addresses {[::1]:9300}, {127.0.0.1:9300} ...생략 [2018-11-19T14:04:04,245][INFO ][o.e.x.s.t.n.SecurityNetty4HttpServerTransport] [8HVXscX] publish_address {127.0.0.1:9200}, bound_addresses {[::1]:9200}, {127.0.0.1:9200} [2018-11-19T14:04:04,248][INFO ][o.e.n.Node ] [8HVXscX] started [2018-11-19T14:04:05,487][INFO ][o.e.l.LicenseService ] [8HVXscX] license [0000f9ea-9beb-4be3-a821-a81a1b65d659] mode [basic] - valid 웹 브라우저를 통해 http://localhost:9200에 접근해보면 아래와 같은 페이지가 뜨는 것을 확인할 수 있다. Kibana 설치 및 실행 Kibana 다운로드 Kibana 다운로드 링크(Linux Tar)를 통해 Kibana 6.5.0 버전을 다운로드한다. Kibana 6.5.0 tar.gz 압축 풀기 tar -zxvf kibana-6.5.0-linux-x86_64.tar.gz 명령어를 통해 압축을 푼다. Front End 모듈이 굉장히 많아서 압축을 푸는데 한세월 걸린다… Kibana 실행 ${설치경로}/bin/kibana serve 명령어를 통해 Kibana를 실행한다. 아래와 같이 로그가 찍히며 맨 아랫줄에 Server running at http://localhost:5601 과 같이 실행되었다는 것을 확인할 수 있다. log [14:48:38.563] [info][status][plugin:kibana@6.5.0] Status changed from uninitialized to green - Ready log [14:48:38.659] [info][status][plugin:elasticsearch@6.5.0] Status changed from uninitialized to yellow - Waiting for Elasticsearch ... 생략 log [14:48:53.541] [info][migrations] Creating index .kibana_1. log [14:48:55.060] [info][migrations] Pointing alias .kibana to .kibana_1. log [14:48:55.288] [info][migrations] Finished in 1747ms. log [14:48:55.292] [info][listening] Server running at http://localhost:5601 http://localhost:5601에 접속해보면 아래와 같이 Kibana의 초기 페이지가 보이는 것을 확인할 수 있다. MetricBeat 설치 및 실행 개요 ElasticSearch 에는 XXXBeat라는 제품군이 있다. Elastic Search에서는 이들을 통용하여 Beats라고 부르는데, Beats는 서버에 설치되어 서버의 운영 데이터를 Elastic Search로 전송하는(Log Stash로 전송한 뒤 Log Stash가 Elastic Search로 전송하는 방식도 있음) Agent 이다. Elastic Search에서는 아래와 같은 Beats들을 제공하고 있다. Elastic Beats To Capture Auditbeat Audit Data Filebeat Log files Heartbeat Availability Monitoring Metricbeat Metric data Packetbeat Network Traffic 서버 상태만을 모니터랑할 예정이기 때문에 일단 Metricbeat을 설치해보도록 한다. MetricBeat 다운로드 MetricBeat 다운로드 링크(Linux Tar)를 통해 MetricBeat 6.5.0 버전을 다운로드한다. MetricBeat 압축 풀기 tar -zxvf metricbeat-6.5.0-linux-x86_64.tar.gz 명령어를 통해 압축을 푼다. MetricBeat 실행 MetricBeat의 system metric 기능 활성화 MetricBeat은 몇몇 Metric 수집/전송 기능을 제공하는데, 이 예제에서는 system metric 수집 및 전송 기능을 테스트한다. ${설치경로}/bin/metricbeat modules enable system 명령어를 통해 system metric module을 활성화한다. MetricBeat Setup MetricBeat과 연결된 Kibana의 Dashboard를 초기화하는 과정이다. ${설치경로}/bin/metricbeat setup -e 명령어를 통해 초기화 할 수 있다. 아래와 같은 로그 메시지가 발생하며 초기화되었다고 성공 메시지로 명령어가 종료된다. 2018-11-19T23:55:19.747+0900 INFO instance/beat.go:616 Home path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Config path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Data path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/data] Logs path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/logs] 2018-11-19T23:55:19.766+0900 INFO instance/beat.go:623 Beat UUID: d4c0cd03-35c3-4c65-b51d-222021e17837 2018-11-19T23:55:19.769+0900 INFO [beat] instance/beat.go:849 Beat info {&quot;system_info&quot;: {&quot;beat&quot;: {&quot;path&quot;: {&quot;config&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;data&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/data&quot;, &quot;home&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;logs&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/logs&quot;}, &quot;type&quot;: &quot;metricbeat&quot;, &quot;uuid&quot;: &quot;d4c0cd03-35c3-4c65-b51d-222021e17837&quot;}}} ... 생략 2018-11-19T23:55:19.826+0900 INFO instance/beat.go:302 Setup Beat: metricbeat; Version: 6.5.0 2018-11-19T23:55:22.836+0900 INFO add_cloud_metadata/add_cloud_metadata.go:319 add_cloud_metadata: hosting provider type not detected. 2018-11-19T23:55:22.885+0900 INFO elasticsearch/client.go:163 Elasticsearch url: http://localhost:9200 2018-11-19T23:55:22.898+0900 INFO [publisher] pipeline/module.go:110 Beat name: leeyh0216-pc 2018-11-19T23:55:22.903+0900 INFO elasticsearch/client.go:163 Elasticsearch url: http://localhost:9200 2018-11-19T23:55:22.917+0900 INFO elasticsearch/client.go:712 Connected to Elasticsearch version 6.5.0 2018-11-19T23:55:22.933+0900 INFO template/load.go:129 Template already exists and will not be overwritten. Loaded index template Loading dashboards (Kibana must be running and reachable) 2018-11-19T23:55:22.938+0900 INFO elasticsearch/client.go:163 Elasticsearch url: http://localhost:9200 2018-11-19T23:55:22.962+0900 INFO elasticsearch/client.go:712 Connected to Elasticsearch version 6.5.0 2018-11-19T23:55:22.967+0900 INFO kibana/client.go:118 Kibana url: http://localhost:5601 2018-11-19T23:55:57.005+0900 INFO instance/beat.go:741 Kibana dashboards successfully loaded. MetricBeat 서비스 실행 위의 두 과정을 통해 MetricBeat의 System 모듈과 MetricBeat과 연결된 Kibana의 Dashboard를 초기화하였다. 이제 MetricBeat을 실행할 차례이다. 아래 명령어를 통해 MetricBeat을 실행한다. ${설치경로}/bin/metricbeat -e 명령어를 입력하면 아래와 같은 로그 메시지가 발생하며 MetricBeat이 실행된 것을 확인할 수 있다. 2018-11-19T23:57:08.793+0900 INFO instance/beat.go:616 Home path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Config path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Data path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/data] Logs path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/logs] 2018-11-19T23:57:08.796+0900 INFO instance/beat.go:623 Beat UUID: d4c0cd03-35c3-4c65-b51d-222021e17837 2018-11-19T23:57:08.799+0900 INFO [seccomp] seccomp/seccomp.go:93 Syscall filter could not be installed because the kernel does not support seccomp 2018-11-19T23:57:08.816+0900 INFO [beat] instance/beat.go:849 Beat info {&quot;system_info&quot;: {&quot;beat&quot;: {&quot;path&quot;: {&quot;config&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;data&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/data&quot;, &quot;home&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;logs&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/logs&quot;}, &quot;type&quot;: &quot;metricbeat&quot;, &quot;uuid&quot;: &quot;d4c0cd03-35c3-4c65-b51d-222021e17837&quot;}}} 2018-11-19T23:57:08.817+0900 INFO [beat] instance/beat.go:858 Build info {&quot;system_info&quot;: {&quot;build&quot;: {&quot;commit&quot;: &quot;ff5b9b3db49856a25b5eda133b6997f2157a4910&quot;, &quot;libbeat&quot;: &quot;6.5.0&quot;, &quot;time&quot;: &quot;2018-11-09T18:03:04.000Z&quot;, &quot;version&quot;: &quot;6.5.0&quot;}}} 2018-11-19T23:57:08.818+0900 INFO [beat] instance/beat.go:861 Go runtime info {&quot;system_info&quot;: {&quot;go&quot;: {&quot;os&quot;:&quot;linux&quot;,&quot;arch&quot;:&quot;amd64&quot;,&quot;max_procs&quot;:4,&quot;version&quot;:&quot;go1.10.3&quot;}}} 2018-11-19T23:57:08.824+0900 INFO [beat] instance/beat.go:865 Host info {&quot;system_info&quot;: {&quot;host&quot;: {&quot;architecture&quot;:&quot;x86_64&quot;,&quot;boot_time&quot;:&quot;2018-11-16T22:41:58+09:00&quot;,&quot;containerized&quot;:true,&quot;name&quot;:&quot;leeyh0216-pc&quot;,&quot;ip&quot;:[&quot;169.254.103.52/16&quot;,&quot;fe80::35ce:4940:4154:6734/64&quot;,&quot;169.254.182.173/16&quot;,&quot;fe80::8595:86d3:ab93:b6ad/64&quot;,&quot;172.22.36.145/28&quot;,&quot;fe80::e0b9:fff1:14a:3de5/64&quot;,&quot;10.0.75.1/24&quot;,&quot;127.0.0.1/8&quot;,&quot;::1/128&quot;,&quot;192.168.219.103/24&quot;,&quot;fe80::f571:57f5:e305:e4ec/64&quot;,&quot;169.254.39.125/16&quot;,&quot;fe80::64b2:28fe:35ae:277d/64&quot;,&quot;169.254.189.130/16&quot;,&quot;fe80::fd70:9829:96ad:bd82/64&quot;],&quot;kernel_version&quot;:&quot;4.4.0-17134-Microsoft&quot;,&quot;mac&quot;:[&quot;c4:9d:ed:8e:1f:7c&quot;,&quot;02:50:f2:00:00:01&quot;,&quot;02:15:06:8b:5d:5c&quot;,&quot;00:15:5d:db:85:04&quot;,&quot;c4:9d:ed:8e:1f:7b&quot;,&quot;c6:9d:ed:8e:1e:7a&quot;,&quot;c6:9d:ed:8e:1b:7a&quot;],&quot;os&quot;:{&quot;family&quot;:&quot;debian&quot;,&quot;platform&quot;:&quot;ubuntu&quot;,&quot;name&quot;:&quot;Ubuntu&quot;,&quot;version&quot;:&quot;16.04.3 LTS (Xenial Xerus)&quot;,&quot;major&quot;:16,&quot;minor&quot;:4,&quot;patch&quot;:3,&quot;codename&quot;:&quot;xenial&quot;},&quot;timezone&quot;:&quot;DST&quot;,&quot;timezone_offset_sec&quot;:32400}}} 2018-11-19T23:57:08.826+0900 INFO [beat] instance/beat.go:894 Process info {&quot;system_info&quot;: {&quot;process&quot;: {&quot;capabilities&quot;: {&quot;inheritable&quot;:null,&quot;permitted&quot;:null,&quot;effective&quot;:null,&quot;bounding&quot;:[&quot;chown&quot;,&quot;dac_override&quot;,&quot;dac_read_search&quot;,&quot;fowner&quot;,&quot;fsetid&quot;,&quot;kill&quot;,&quot;setgid&quot;,&quot;setuid&quot;,&quot;setpcap&quot;,&quot;linux_immutable&quot;,&quot;net_bind_service&quot;,&quot;net_broadcast&quot;,&quot;net_admin&quot;,&quot;net_raw&quot;,&quot;ipc_lock&quot;,&quot;ipc_owner&quot;,&quot;sys_module&quot;,&quot;sys_rawio&quot;,&quot;sys_chroot&quot;,&quot;sys_ptrace&quot;,&quot;sys_pacct&quot;,&quot;sys_admin&quot;,&quot;sys_boot&quot;,&quot;sys_nice&quot;,&quot;sys_resource&quot;,&quot;sys_time&quot;,&quot;sys_tty_config&quot;,&quot;mknod&quot;,&quot;lease&quot;,&quot;audit_write&quot;,&quot;audit_control&quot;,&quot;setfcap&quot;,&quot;mac_override&quot;,&quot;mac_admin&quot;,&quot;syslog&quot;,&quot;wake_alarm&quot;,&quot;block_suspend&quot;],&quot;ambient&quot;:null}, &quot;cwd&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;exe&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/metricbeat&quot;, &quot;name&quot;: &quot;metricbeat&quot;, &quot;pid&quot;: 1790, &quot;ppid&quot;: 1641, &quot;seccomp&quot;: {&quot;mode&quot;:&quot;&quot;}, &quot;start_time&quot;: &quot;2018-11-19T23:57:07.900+0900&quot;}}} 2018-11-19T23:57:08.827+0900 INFO instance/beat.go:302 Setup Beat: metricbeat; Version: 6.5.0 2018-11-19T23:57:11.839+0900 INFO add_cloud_metadata/add_cloud_metadata.go:319 add_cloud_metadata: hosting provider type not detected. 2018-11-19T23:57:11.845+0900 INFO elasticsearch/client.go:163 Elasticsearch url: http://localhost:9200 2018-11-19T23:57:11.871+0900 INFO [publisher] pipeline/module.go:110 Beat name: leeyh0216-pc 2018-11-19T23:57:11.909+0900 INFO [monitoring] log/log.go:117 Starting metrics logging every 30s 2018-11-19T23:57:11.911+0900 INFO instance/beat.go:424 metricbeat start running. ...생략 2018-11-19T23:57:13.116+0900 INFO template/load.go:129 Template already exists and will not be overwritten. 2018-11-19T23:57:13.118+0900 INFO pipeline/output.go:105 Connection to backoff(elasticsearch(http://localhost:9200)) established 2018-11-19T23:57:41.953+0900 INFO [monitoring] log/log.go:144 Non-zero metrics in the last 30s {&quot;monitoring&quot;: {&quot;metrics&quot;: {&quot;beat&quot;:{&quot;cpu&quot;:{&quot;system&quot;:{&quot;ticks&quot;:480,&quot;time&quot;:{&quot;ms&quot;:484}},&quot;total&quot;:{&quot;ticks&quot;:680,&quot;time&quot;:{&quot;ms&quot;:687},&quot;value&quot;:0},&quot;user&quot;:{&quot;ticks&quot;:200,&quot;time&quot;:{&quot;ms&quot;:203}}},&quot;handles&quot;:{&quot;limit&quot;:{&quot;hard&quot;:4096,&quot;soft&quot;:1024},&quot;open&quot;:6},&quot;info&quot;:{&quot;ephemeral_id&quot;:&quot;f91190da-ef4b-4bcd-9cc3-9b84419376fa&quot;,&quot;uptime&quot;:{&quot;ms&quot;:33233}},&quot;memstats&quot;:{&quot;gc_next&quot;:6331744,&quot;memory_alloc&quot;:5023160,&quot;memory_total&quot;:17274296,&quot;rss&quot;:25976832}},&quot;libbeat&quot;:{&quot;config&quot;:{&quot;module&quot;:{&quot;running&quot;:0},&quot;reloads&quot;:1},&quot;output&quot;:{&quot;events&quot;:{&quot;acked&quot;:62,&quot;batches&quot;:3,&quot;total&quot;:62},&quot;read&quot;:{&quot;bytes&quot;:1902},&quot;type&quot;:&quot;elasticsearch&quot;,&quot;write&quot;:{&quot;bytes&quot;:45366}},&quot;pipeline&quot;:{&quot;clients&quot;:6,&quot;events&quot;:{&quot;active&quot;:0,&quot;published&quot;:62,&quot;retry&quot;:24,&quot;total&quot;:62},&quot;queue&quot;:{&quot;acked&quot;:62}}},&quot;metricbeat&quot;:{&quot;system&quot;:{&quot;cpu&quot;:{&quot;events&quot;:3,&quot;success&quot;:3},&quot;filesystem&quot;:{&quot;events&quot;:1,&quot;failures&quot;:1},&quot;fsstat&quot;:{&quot;events&quot;:1,&quot;failures&quot;:1},&quot;load&quot;:{&quot;events&quot;:3,&quot;success&quot;:3},&quot;memory&quot;:{&quot;events&quot;:3,&quot;success&quot;:3},&quot;network&quot;:{&quot;events&quot;:24,&quot;success&quot;:24},&quot;process&quot;:{&quot;events&quot;:23,&quot;success&quot;:23},&quot;process_summary&quot;:{&quot;events&quot;:3,&quot;success&quot;:3},&quot;uptime&quot;:{&quot;events&quot;:1,&quot;success&quot;:1}}},&quot;system&quot;:{&quot;cpu&quot;:{&quot;cores&quot;:4},&quot;load&quot;:{&quot;1&quot;:0.52,&quot;15&quot;:0.59,&quot;5&quot;:0.58,&quot;norm&quot;:{&quot;1&quot;:0.13,&quot;15&quot;:0.1475,&quot;5&quot;:0.145}}}}}} 일정 시간마다 맨 아랫줄과 같은 시스템 정보를 Elastic Search로 전송하는 것을 확인할 수 있다. Kibana의 Dashboard 메뉴를 클릭해보면 아래와 같이 여러 개의 Dashboard가 생성된 것을 확인할 수 있으며 System Dashboard로 들어가보면 아래와 같이 System 상태가 기록되는 것을 확인할 수 있다. 정리 다운로드/설치만을 통해 기본 값으로 실행해서 그런지 막힘 없이 진행할 수 있었다. 대시보드의 지표들을 확인해보니 확실히 Zabbix 보다 많은 기능을 제공해주는 것 같긴 하다. 좀 더 기능적인 부분에 대해 확인해본 후 도입을 결정해야할 것 같다." /><link rel="canonical" href="https://leeyh0216.github.io/posts/elasticsearch-1/" /><meta property="og:url" content="https://leeyh0216.github.io/posts/elasticsearch-1/" /><meta property="og:site_name" content="leeyh0216’s devlog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-11-19T15:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ElasticSearch + MetricBeat + Kibana로 서버 모니터링하기" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@leeyh0216" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"leeyh0216"},"description":"개요 내가 근무하는 팀에서의 프로젝트는 아래와 같이 크게 두 가지로 분류된다. Hadoop Cluster에서 동작하는 배치 작업(일, 시간 단위) 위의 배치 작업의 메타데이터 및 작업 상태, 의존성 등을 관리하는 웹 서비스(WAS) Hadoop Cluster의 경우 다른 팀에서 운영을 맡고 있기 때문에 내가 작성한 프로그램이 사용하는 리소스나 코드를 최적화 시켜주면 운영 과정에서는 별다른 문제가 발생하지 않는다. 그러나 웹 서비스의 경우 동작하는 서버를 우리 팀에서 관리하기 때문에 어플리케이션 뿐만 아니라 서버, DB 또한 우리가 직접 관리해주어야 한다. 가끔 서비스에서 문제가 발생할 경우 로그 확인 뿐만 아니라 Zabbix 등을 이용하여 당시 서버의 리소스 상태를 확인하는 경우가 있는데, 정말 개괄적인 지표만을 제공하기 때문에 좀 더 세분화된 지표를 기록해야 하는 상황이 생기고 있다. Elastic Search 공식 사이트의 Getting Started With Elastic Stack 글을 보며 설치 및 실행을 테스트해보고자 한다. 설치 환경 Ubuntu 14.04 On Windows(WCL) Oracle JDK 1.8.0_181 Elastic Stack 설치 및 실행 Elastic Search 6.5.0 다운로드 ElasticSearch 다운로드 링크(Linux Tar) 를 통해 6.5.0 버전의 Elastic Search를 다운로드한다. Elastic Search tar.gz 파일 압축 풀기 tar -zxvf elasticsearch-6.5.0.tar.gz 명령어를 이용해 설치할 경로에 압축을 푼다. Elastic Search 실행 ${설치 경로}/bin/elasticsearch -d 명령어를 통해 Elastic Search를 실행(기본 옵션)한다. -d 옵션은 데몬으로 동작시킨다는 의미이다. 아래와 같이 몇몇 오류 메시지를 내뱉으며 실행되는 것을 확인할 수 있다.(몇몇 WARN 로그가 발생하지만 일단 건너뛰도록 한다) [2018-11-19T14:03:43,713][WARN ][o.e.b.JNANatives ] [unknown] unable to install syscall filter: ... 생략 [2018-11-19T14:03:57,629][INFO ][o.e.x.s.a.s.FileRolesStore] [8HVXscX] parsed [0] roles from file [/usr/lib/elasticsearch-6.5.0/config/roles.yml] [2018-11-19T14:03:58,365][INFO ][o.e.x.m.j.p.l.CppLogMessageHandler] [8HVXscX] [controller/1259] [Main.cc@109] controller (64 bit): Version 6.5.0 (Build 71882a589e5556) Copyright (c) 2018 Elasticsearch BV [2018-11-19T14:03:59,034][DEBUG][o.e.a.ActionModule ] [8HVXscX] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security [2018-11-19T14:03:59,407][INFO ][o.e.d.DiscoveryModule ] [8HVXscX] using discovery type [zen] and host providers [settings] [2018-11-19T14:04:00,676][INFO ][o.e.n.Node ] [8HVXscX] initialized [2018-11-19T14:04:00,677][INFO ][o.e.n.Node ] [8HVXscX] starting ... [2018-11-19T14:04:00,965][INFO ][o.e.t.TransportService ] [8HVXscX] publish_address {127.0.0.1:9300}, bound_addresses {[::1]:9300}, {127.0.0.1:9300} ...생략 [2018-11-19T14:04:04,245][INFO ][o.e.x.s.t.n.SecurityNetty4HttpServerTransport] [8HVXscX] publish_address {127.0.0.1:9200}, bound_addresses {[::1]:9200}, {127.0.0.1:9200} [2018-11-19T14:04:04,248][INFO ][o.e.n.Node ] [8HVXscX] started [2018-11-19T14:04:05,487][INFO ][o.e.l.LicenseService ] [8HVXscX] license [0000f9ea-9beb-4be3-a821-a81a1b65d659] mode [basic] - valid 웹 브라우저를 통해 http://localhost:9200에 접근해보면 아래와 같은 페이지가 뜨는 것을 확인할 수 있다. Kibana 설치 및 실행 Kibana 다운로드 Kibana 다운로드 링크(Linux Tar)를 통해 Kibana 6.5.0 버전을 다운로드한다. Kibana 6.5.0 tar.gz 압축 풀기 tar -zxvf kibana-6.5.0-linux-x86_64.tar.gz 명령어를 통해 압축을 푼다. Front End 모듈이 굉장히 많아서 압축을 푸는데 한세월 걸린다… Kibana 실행 ${설치경로}/bin/kibana serve 명령어를 통해 Kibana를 실행한다. 아래와 같이 로그가 찍히며 맨 아랫줄에 Server running at http://localhost:5601 과 같이 실행되었다는 것을 확인할 수 있다. log [14:48:38.563] [info][status][plugin:kibana@6.5.0] Status changed from uninitialized to green - Ready log [14:48:38.659] [info][status][plugin:elasticsearch@6.5.0] Status changed from uninitialized to yellow - Waiting for Elasticsearch ... 생략 log [14:48:53.541] [info][migrations] Creating index .kibana_1. log [14:48:55.060] [info][migrations] Pointing alias .kibana to .kibana_1. log [14:48:55.288] [info][migrations] Finished in 1747ms. log [14:48:55.292] [info][listening] Server running at http://localhost:5601 http://localhost:5601에 접속해보면 아래와 같이 Kibana의 초기 페이지가 보이는 것을 확인할 수 있다. MetricBeat 설치 및 실행 개요 ElasticSearch 에는 XXXBeat라는 제품군이 있다. Elastic Search에서는 이들을 통용하여 Beats라고 부르는데, Beats는 서버에 설치되어 서버의 운영 데이터를 Elastic Search로 전송하는(Log Stash로 전송한 뒤 Log Stash가 Elastic Search로 전송하는 방식도 있음) Agent 이다. Elastic Search에서는 아래와 같은 Beats들을 제공하고 있다. Elastic Beats To Capture Auditbeat Audit Data Filebeat Log files Heartbeat Availability Monitoring Metricbeat Metric data Packetbeat Network Traffic 서버 상태만을 모니터랑할 예정이기 때문에 일단 Metricbeat을 설치해보도록 한다. MetricBeat 다운로드 MetricBeat 다운로드 링크(Linux Tar)를 통해 MetricBeat 6.5.0 버전을 다운로드한다. MetricBeat 압축 풀기 tar -zxvf metricbeat-6.5.0-linux-x86_64.tar.gz 명령어를 통해 압축을 푼다. MetricBeat 실행 MetricBeat의 system metric 기능 활성화 MetricBeat은 몇몇 Metric 수집/전송 기능을 제공하는데, 이 예제에서는 system metric 수집 및 전송 기능을 테스트한다. ${설치경로}/bin/metricbeat modules enable system 명령어를 통해 system metric module을 활성화한다. MetricBeat Setup MetricBeat과 연결된 Kibana의 Dashboard를 초기화하는 과정이다. ${설치경로}/bin/metricbeat setup -e 명령어를 통해 초기화 할 수 있다. 아래와 같은 로그 메시지가 발생하며 초기화되었다고 성공 메시지로 명령어가 종료된다. 2018-11-19T23:55:19.747+0900 INFO instance/beat.go:616 Home path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Config path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Data path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/data] Logs path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/logs] 2018-11-19T23:55:19.766+0900 INFO instance/beat.go:623 Beat UUID: d4c0cd03-35c3-4c65-b51d-222021e17837 2018-11-19T23:55:19.769+0900 INFO [beat] instance/beat.go:849 Beat info {&quot;system_info&quot;: {&quot;beat&quot;: {&quot;path&quot;: {&quot;config&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;data&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/data&quot;, &quot;home&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;logs&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/logs&quot;}, &quot;type&quot;: &quot;metricbeat&quot;, &quot;uuid&quot;: &quot;d4c0cd03-35c3-4c65-b51d-222021e17837&quot;}}} ... 생략 2018-11-19T23:55:19.826+0900 INFO instance/beat.go:302 Setup Beat: metricbeat; Version: 6.5.0 2018-11-19T23:55:22.836+0900 INFO add_cloud_metadata/add_cloud_metadata.go:319 add_cloud_metadata: hosting provider type not detected. 2018-11-19T23:55:22.885+0900 INFO elasticsearch/client.go:163 Elasticsearch url: http://localhost:9200 2018-11-19T23:55:22.898+0900 INFO [publisher] pipeline/module.go:110 Beat name: leeyh0216-pc 2018-11-19T23:55:22.903+0900 INFO elasticsearch/client.go:163 Elasticsearch url: http://localhost:9200 2018-11-19T23:55:22.917+0900 INFO elasticsearch/client.go:712 Connected to Elasticsearch version 6.5.0 2018-11-19T23:55:22.933+0900 INFO template/load.go:129 Template already exists and will not be overwritten. Loaded index template Loading dashboards (Kibana must be running and reachable) 2018-11-19T23:55:22.938+0900 INFO elasticsearch/client.go:163 Elasticsearch url: http://localhost:9200 2018-11-19T23:55:22.962+0900 INFO elasticsearch/client.go:712 Connected to Elasticsearch version 6.5.0 2018-11-19T23:55:22.967+0900 INFO kibana/client.go:118 Kibana url: http://localhost:5601 2018-11-19T23:55:57.005+0900 INFO instance/beat.go:741 Kibana dashboards successfully loaded. MetricBeat 서비스 실행 위의 두 과정을 통해 MetricBeat의 System 모듈과 MetricBeat과 연결된 Kibana의 Dashboard를 초기화하였다. 이제 MetricBeat을 실행할 차례이다. 아래 명령어를 통해 MetricBeat을 실행한다. ${설치경로}/bin/metricbeat -e 명령어를 입력하면 아래와 같은 로그 메시지가 발생하며 MetricBeat이 실행된 것을 확인할 수 있다. 2018-11-19T23:57:08.793+0900 INFO instance/beat.go:616 Home path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Config path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Data path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/data] Logs path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/logs] 2018-11-19T23:57:08.796+0900 INFO instance/beat.go:623 Beat UUID: d4c0cd03-35c3-4c65-b51d-222021e17837 2018-11-19T23:57:08.799+0900 INFO [seccomp] seccomp/seccomp.go:93 Syscall filter could not be installed because the kernel does not support seccomp 2018-11-19T23:57:08.816+0900 INFO [beat] instance/beat.go:849 Beat info {&quot;system_info&quot;: {&quot;beat&quot;: {&quot;path&quot;: {&quot;config&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;data&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/data&quot;, &quot;home&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;logs&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/logs&quot;}, &quot;type&quot;: &quot;metricbeat&quot;, &quot;uuid&quot;: &quot;d4c0cd03-35c3-4c65-b51d-222021e17837&quot;}}} 2018-11-19T23:57:08.817+0900 INFO [beat] instance/beat.go:858 Build info {&quot;system_info&quot;: {&quot;build&quot;: {&quot;commit&quot;: &quot;ff5b9b3db49856a25b5eda133b6997f2157a4910&quot;, &quot;libbeat&quot;: &quot;6.5.0&quot;, &quot;time&quot;: &quot;2018-11-09T18:03:04.000Z&quot;, &quot;version&quot;: &quot;6.5.0&quot;}}} 2018-11-19T23:57:08.818+0900 INFO [beat] instance/beat.go:861 Go runtime info {&quot;system_info&quot;: {&quot;go&quot;: {&quot;os&quot;:&quot;linux&quot;,&quot;arch&quot;:&quot;amd64&quot;,&quot;max_procs&quot;:4,&quot;version&quot;:&quot;go1.10.3&quot;}}} 2018-11-19T23:57:08.824+0900 INFO [beat] instance/beat.go:865 Host info {&quot;system_info&quot;: {&quot;host&quot;: {&quot;architecture&quot;:&quot;x86_64&quot;,&quot;boot_time&quot;:&quot;2018-11-16T22:41:58+09:00&quot;,&quot;containerized&quot;:true,&quot;name&quot;:&quot;leeyh0216-pc&quot;,&quot;ip&quot;:[&quot;169.254.103.52/16&quot;,&quot;fe80::35ce:4940:4154:6734/64&quot;,&quot;169.254.182.173/16&quot;,&quot;fe80::8595:86d3:ab93:b6ad/64&quot;,&quot;172.22.36.145/28&quot;,&quot;fe80::e0b9:fff1:14a:3de5/64&quot;,&quot;10.0.75.1/24&quot;,&quot;127.0.0.1/8&quot;,&quot;::1/128&quot;,&quot;192.168.219.103/24&quot;,&quot;fe80::f571:57f5:e305:e4ec/64&quot;,&quot;169.254.39.125/16&quot;,&quot;fe80::64b2:28fe:35ae:277d/64&quot;,&quot;169.254.189.130/16&quot;,&quot;fe80::fd70:9829:96ad:bd82/64&quot;],&quot;kernel_version&quot;:&quot;4.4.0-17134-Microsoft&quot;,&quot;mac&quot;:[&quot;c4:9d:ed:8e:1f:7c&quot;,&quot;02:50:f2:00:00:01&quot;,&quot;02:15:06:8b:5d:5c&quot;,&quot;00:15:5d:db:85:04&quot;,&quot;c4:9d:ed:8e:1f:7b&quot;,&quot;c6:9d:ed:8e:1e:7a&quot;,&quot;c6:9d:ed:8e:1b:7a&quot;],&quot;os&quot;:{&quot;family&quot;:&quot;debian&quot;,&quot;platform&quot;:&quot;ubuntu&quot;,&quot;name&quot;:&quot;Ubuntu&quot;,&quot;version&quot;:&quot;16.04.3 LTS (Xenial Xerus)&quot;,&quot;major&quot;:16,&quot;minor&quot;:4,&quot;patch&quot;:3,&quot;codename&quot;:&quot;xenial&quot;},&quot;timezone&quot;:&quot;DST&quot;,&quot;timezone_offset_sec&quot;:32400}}} 2018-11-19T23:57:08.826+0900 INFO [beat] instance/beat.go:894 Process info {&quot;system_info&quot;: {&quot;process&quot;: {&quot;capabilities&quot;: {&quot;inheritable&quot;:null,&quot;permitted&quot;:null,&quot;effective&quot;:null,&quot;bounding&quot;:[&quot;chown&quot;,&quot;dac_override&quot;,&quot;dac_read_search&quot;,&quot;fowner&quot;,&quot;fsetid&quot;,&quot;kill&quot;,&quot;setgid&quot;,&quot;setuid&quot;,&quot;setpcap&quot;,&quot;linux_immutable&quot;,&quot;net_bind_service&quot;,&quot;net_broadcast&quot;,&quot;net_admin&quot;,&quot;net_raw&quot;,&quot;ipc_lock&quot;,&quot;ipc_owner&quot;,&quot;sys_module&quot;,&quot;sys_rawio&quot;,&quot;sys_chroot&quot;,&quot;sys_ptrace&quot;,&quot;sys_pacct&quot;,&quot;sys_admin&quot;,&quot;sys_boot&quot;,&quot;sys_nice&quot;,&quot;sys_resource&quot;,&quot;sys_time&quot;,&quot;sys_tty_config&quot;,&quot;mknod&quot;,&quot;lease&quot;,&quot;audit_write&quot;,&quot;audit_control&quot;,&quot;setfcap&quot;,&quot;mac_override&quot;,&quot;mac_admin&quot;,&quot;syslog&quot;,&quot;wake_alarm&quot;,&quot;block_suspend&quot;],&quot;ambient&quot;:null}, &quot;cwd&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64&quot;, &quot;exe&quot;: &quot;/usr/lib/metricbeat-6.5.0-linux-x86_64/metricbeat&quot;, &quot;name&quot;: &quot;metricbeat&quot;, &quot;pid&quot;: 1790, &quot;ppid&quot;: 1641, &quot;seccomp&quot;: {&quot;mode&quot;:&quot;&quot;}, &quot;start_time&quot;: &quot;2018-11-19T23:57:07.900+0900&quot;}}} 2018-11-19T23:57:08.827+0900 INFO instance/beat.go:302 Setup Beat: metricbeat; Version: 6.5.0 2018-11-19T23:57:11.839+0900 INFO add_cloud_metadata/add_cloud_metadata.go:319 add_cloud_metadata: hosting provider type not detected. 2018-11-19T23:57:11.845+0900 INFO elasticsearch/client.go:163 Elasticsearch url: http://localhost:9200 2018-11-19T23:57:11.871+0900 INFO [publisher] pipeline/module.go:110 Beat name: leeyh0216-pc 2018-11-19T23:57:11.909+0900 INFO [monitoring] log/log.go:117 Starting metrics logging every 30s 2018-11-19T23:57:11.911+0900 INFO instance/beat.go:424 metricbeat start running. ...생략 2018-11-19T23:57:13.116+0900 INFO template/load.go:129 Template already exists and will not be overwritten. 2018-11-19T23:57:13.118+0900 INFO pipeline/output.go:105 Connection to backoff(elasticsearch(http://localhost:9200)) established 2018-11-19T23:57:41.953+0900 INFO [monitoring] log/log.go:144 Non-zero metrics in the last 30s {&quot;monitoring&quot;: {&quot;metrics&quot;: {&quot;beat&quot;:{&quot;cpu&quot;:{&quot;system&quot;:{&quot;ticks&quot;:480,&quot;time&quot;:{&quot;ms&quot;:484}},&quot;total&quot;:{&quot;ticks&quot;:680,&quot;time&quot;:{&quot;ms&quot;:687},&quot;value&quot;:0},&quot;user&quot;:{&quot;ticks&quot;:200,&quot;time&quot;:{&quot;ms&quot;:203}}},&quot;handles&quot;:{&quot;limit&quot;:{&quot;hard&quot;:4096,&quot;soft&quot;:1024},&quot;open&quot;:6},&quot;info&quot;:{&quot;ephemeral_id&quot;:&quot;f91190da-ef4b-4bcd-9cc3-9b84419376fa&quot;,&quot;uptime&quot;:{&quot;ms&quot;:33233}},&quot;memstats&quot;:{&quot;gc_next&quot;:6331744,&quot;memory_alloc&quot;:5023160,&quot;memory_total&quot;:17274296,&quot;rss&quot;:25976832}},&quot;libbeat&quot;:{&quot;config&quot;:{&quot;module&quot;:{&quot;running&quot;:0},&quot;reloads&quot;:1},&quot;output&quot;:{&quot;events&quot;:{&quot;acked&quot;:62,&quot;batches&quot;:3,&quot;total&quot;:62},&quot;read&quot;:{&quot;bytes&quot;:1902},&quot;type&quot;:&quot;elasticsearch&quot;,&quot;write&quot;:{&quot;bytes&quot;:45366}},&quot;pipeline&quot;:{&quot;clients&quot;:6,&quot;events&quot;:{&quot;active&quot;:0,&quot;published&quot;:62,&quot;retry&quot;:24,&quot;total&quot;:62},&quot;queue&quot;:{&quot;acked&quot;:62}}},&quot;metricbeat&quot;:{&quot;system&quot;:{&quot;cpu&quot;:{&quot;events&quot;:3,&quot;success&quot;:3},&quot;filesystem&quot;:{&quot;events&quot;:1,&quot;failures&quot;:1},&quot;fsstat&quot;:{&quot;events&quot;:1,&quot;failures&quot;:1},&quot;load&quot;:{&quot;events&quot;:3,&quot;success&quot;:3},&quot;memory&quot;:{&quot;events&quot;:3,&quot;success&quot;:3},&quot;network&quot;:{&quot;events&quot;:24,&quot;success&quot;:24},&quot;process&quot;:{&quot;events&quot;:23,&quot;success&quot;:23},&quot;process_summary&quot;:{&quot;events&quot;:3,&quot;success&quot;:3},&quot;uptime&quot;:{&quot;events&quot;:1,&quot;success&quot;:1}}},&quot;system&quot;:{&quot;cpu&quot;:{&quot;cores&quot;:4},&quot;load&quot;:{&quot;1&quot;:0.52,&quot;15&quot;:0.59,&quot;5&quot;:0.58,&quot;norm&quot;:{&quot;1&quot;:0.13,&quot;15&quot;:0.1475,&quot;5&quot;:0.145}}}}}} 일정 시간마다 맨 아랫줄과 같은 시스템 정보를 Elastic Search로 전송하는 것을 확인할 수 있다. Kibana의 Dashboard 메뉴를 클릭해보면 아래와 같이 여러 개의 Dashboard가 생성된 것을 확인할 수 있으며 System Dashboard로 들어가보면 아래와 같이 System 상태가 기록되는 것을 확인할 수 있다. 정리 다운로드/설치만을 통해 기본 값으로 실행해서 그런지 막힘 없이 진행할 수 있었다. 대시보드의 지표들을 확인해보니 확실히 Zabbix 보다 많은 기능을 제공해주는 것 같긴 하다. 좀 더 기능적인 부분에 대해 확인해본 후 도입을 결정해야할 것 같다.","url":"https://leeyh0216.github.io/posts/elasticsearch-1/","@type":"BlogPosting","headline":"ElasticSearch + MetricBeat + Kibana로 서버 모니터링하기","dateModified":"2018-11-19T15:00:00+09:00","datePublished":"2018-11-19T15:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://leeyh0216.github.io/posts/elasticsearch-1/"},"@context":"https://schema.org"}</script><title>ElasticSearch + MetricBeat + Kibana로 서버 모니터링하기 | leeyh0216's devlog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script async src="/assets/js/dist/pvreport.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-129061352-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-129061352-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">leeyh0216's devlog</a></div><div class="site-subtitle font-italic">개발/일상 블로그</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/leeyh0216" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/%EC%9A%A9%ED%99%98-%EC%9D%B4-84222a119/" aria-label="linkedin" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['leeyh0216','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>ElasticSearch + MetricBeat + Kibana로 서버 모니터링하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>ElasticSearch + MetricBeat + Kibana로 서버 모니터링하기</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> leeyh0216 </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Nov 19, 2018, 3:00 PM +0900" prep="on" > Nov 19, 2018 <i class="unloaded">2018-11-19T15:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1907 words">10 min</span> <span id="pv" class="pageviews"><i class="fas fa-spinner fa-spin fa-fw"></i></span></div></div><div class="post-content"><h1 id="개요">개요</h1><p>내가 근무하는 팀에서의 프로젝트는 아래와 같이 크게 두 가지로 분류된다.</p><ul><li>Hadoop Cluster에서 동작하는 배치 작업(일, 시간 단위)<li>위의 배치 작업의 메타데이터 및 작업 상태, 의존성 등을 관리하는 웹 서비스(WAS)</ul><p>Hadoop Cluster의 경우 다른 팀에서 운영을 맡고 있기 때문에 내가 작성한 프로그램이 사용하는 리소스나 코드를 최적화 시켜주면 운영 과정에서는 별다른 문제가 발생하지 않는다.</p><p>그러나 웹 서비스의 경우 동작하는 서버를 우리 팀에서 관리하기 때문에 어플리케이션 뿐만 아니라 서버, DB 또한 우리가 직접 관리해주어야 한다.</p><p>가끔 서비스에서 문제가 발생할 경우 로그 확인 뿐만 아니라 Zabbix 등을 이용하여 당시 서버의 리소스 상태를 확인하는 경우가 있는데, 정말 개괄적인 지표만을 제공하기 때문에 좀 더 세분화된 지표를 기록해야 하는 상황이 생기고 있다.</p><p>Elastic Search 공식 사이트의 <a href="https://www.elastic.co/guide/en/elastic-stack-get-started/current/get-started-elastic-stack.html">Getting Started With Elastic Stack</a> 글을 보며 설치 및 실행을 테스트해보고자 한다.</p><h1 id="설치-환경">설치 환경</h1><ul><li>Ubuntu 14.04 On Windows(WCL)<li>Oracle JDK 1.8.0_181</ul><h1 id="elastic-stack-설치-및-실행">Elastic Stack 설치 및 실행</h1><h2 id="elastic-search-650-다운로드">Elastic Search 6.5.0 다운로드</h2><p><a href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.5.0.tar.gz">ElasticSearch 다운로드 링크(Linux Tar)</a> 를 통해 6.5.0 버전의 Elastic Search를 다운로드한다.</p><h2 id="elastic-search-targz-파일-압축-풀기">Elastic Search tar.gz 파일 압축 풀기</h2><p><code class="language-plaintext highlighter-rouge">tar -zxvf elasticsearch-6.5.0.tar.gz</code> 명령어를 이용해 설치할 경로에 압축을 푼다.</p><h2 id="elastic-search-실행">Elastic Search 실행</h2><p><code class="language-plaintext highlighter-rouge">${설치 경로}/bin/elasticsearch -d</code> 명령어를 통해 Elastic Search를 실행(기본 옵션)한다. -d 옵션은 데몬으로 동작시킨다는 의미이다.</p><p>아래와 같이 몇몇 오류 메시지를 내뱉으며 실행되는 것을 확인할 수 있다.(몇몇 WARN 로그가 발생하지만 일단 건너뛰도록 한다)</p><figure class="highlight"><pre><code class="language-text" data-lang="text">[2018-11-19T14:03:43,713][WARN ][o.e.b.JNANatives         ] [unknown] unable to install syscall filter:
... 생략
[2018-11-19T14:03:57,629][INFO ][o.e.x.s.a.s.FileRolesStore] [8HVXscX] parsed [0] roles from file [/usr/lib/elasticsearch-6.5.0/config/roles.yml]
[2018-11-19T14:03:58,365][INFO ][o.e.x.m.j.p.l.CppLogMessageHandler] [8HVXscX] [controller/1259] [Main.cc@109] controller (64 bit): Version 6.5.0 (Build 71882a589e5556) Copyright (c) 2018 Elasticsearch BV
[2018-11-19T14:03:59,034][DEBUG][o.e.a.ActionModule       ] [8HVXscX] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security
[2018-11-19T14:03:59,407][INFO ][o.e.d.DiscoveryModule    ] [8HVXscX] using discovery type [zen] and host providers [settings]
[2018-11-19T14:04:00,676][INFO ][o.e.n.Node               ] [8HVXscX] initialized
[2018-11-19T14:04:00,677][INFO ][o.e.n.Node               ] [8HVXscX] starting ...
[2018-11-19T14:04:00,965][INFO ][o.e.t.TransportService   ] [8HVXscX] publish_address {127.0.0.1:9300}, bound_addresses {[::1]:9300}, {127.0.0.1:9300}
...생략
[2018-11-19T14:04:04,245][INFO ][o.e.x.s.t.n.SecurityNetty4HttpServerTransport] [8HVXscX] publish_address {127.0.0.1:9200}, bound_addresses {[::1]:9200}, {127.0.0.1:9200}
[2018-11-19T14:04:04,248][INFO ][o.e.n.Node               ] [8HVXscX] started
[2018-11-19T14:04:05,487][INFO ][o.e.l.LicenseService     ] [8HVXscX] license [0000f9ea-9beb-4be3-a821-a81a1b65d659] mode [basic] - valid</code></pre></figure><p>웹 브라우저를 통해 <code class="language-plaintext highlighter-rouge">http://localhost:9200</code>에 접근해보면 아래와 같은 페이지가 뜨는 것을 확인할 수 있다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/elasticsearch/elasticsearch_intro.jpg" alt="Elastic Search Main Page" /></p><h1 id="kibana-설치-및-실행">Kibana 설치 및 실행</h1><h2 id="kibana-다운로드">Kibana 다운로드</h2><p><a href="https://artifacts.elastic.co/downloads/kibana/kibana-6.5.0-linux-x86_64.tar.gz">Kibana 다운로드 링크(Linux Tar)</a>를 통해 Kibana 6.5.0 버전을 다운로드한다.</p><h2 id="kibana-650-targz-압축-풀기">Kibana 6.5.0 tar.gz 압축 풀기</h2><p><code class="language-plaintext highlighter-rouge">tar -zxvf kibana-6.5.0-linux-x86_64.tar.gz</code> 명령어를 통해 압축을 푼다. Front End 모듈이 굉장히 많아서 압축을 푸는데 한세월 걸린다…</p><h2 id="kibana-실행">Kibana 실행</h2><p><code class="language-plaintext highlighter-rouge">${설치경로}/bin/kibana serve</code> 명령어를 통해 Kibana를 실행한다.</p><p>아래와 같이 로그가 찍히며 맨 아랫줄에 Server running at http://localhost:5601 과 같이 실행되었다는 것을 확인할 수 있다.</p><figure class="highlight"><pre><code class="language-text" data-lang="text">  log   [14:48:38.563] [info][status][plugin:kibana@6.5.0] Status changed from uninitialized to green - Ready
  log   [14:48:38.659] [info][status][plugin:elasticsearch@6.5.0] Status changed from uninitialized to yellow - Waiting for Elasticsearch
  ... 생략
  log   [14:48:53.541] [info][migrations] Creating index .kibana_1.
  log   [14:48:55.060] [info][migrations] Pointing alias .kibana to .kibana_1.
  log   [14:48:55.288] [info][migrations] Finished in 1747ms.
  log   [14:48:55.292] [info][listening] Server running at http://localhost:5601</code></pre></figure><p><code class="language-plaintext highlighter-rouge">http://localhost:5601</code>에 접속해보면 아래와 같이 Kibana의 초기 페이지가 보이는 것을 확인할 수 있다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/elasticsearch/kibana_intro.jpg" alt="Kibana Intro Page" /></p><h1 id="metricbeat-설치-및-실행">MetricBeat 설치 및 실행</h1><h2 id="개요-1">개요</h2><p>ElasticSearch 에는 XXXBeat라는 제품군이 있다. Elastic Search에서는 이들을 통용하여 Beats라고 부르는데, Beats는 서버에 설치되어 서버의 운영 데이터를 Elastic Search로 전송하는(Log Stash로 전송한 뒤 Log Stash가 Elastic Search로 전송하는 방식도 있음) Agent 이다.</p><p>Elastic Search에서는 아래와 같은 Beats들을 제공하고 있다.</p><div class="table-wrapper"><table><thead><tr><th>Elastic Beats<th>To Capture<tbody><tr><td>Auditbeat<td>Audit Data<tr><td>Filebeat<td>Log files<tr><td>Heartbeat<td>Availability Monitoring<tr><td>Metricbeat<td>Metric data<tr><td>Packetbeat<td>Network Traffic</table></div><p>서버 상태만을 모니터랑할 예정이기 때문에 일단 Metricbeat을 설치해보도록 한다.</p><h2 id="metricbeat-다운로드">MetricBeat 다운로드</h2><p><a href="https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-6.5.0-linux-x86_64.tar.gz">MetricBeat 다운로드 링크(Linux Tar)</a>를 통해 MetricBeat 6.5.0 버전을 다운로드한다.</p><h2 id="metricbeat-압축-풀기">MetricBeat 압축 풀기</h2><p><code class="language-plaintext highlighter-rouge">tar -zxvf metricbeat-6.5.0-linux-x86_64.tar.gz</code> 명령어를 통해 압축을 푼다.</p><h2 id="metricbeat-실행">MetricBeat 실행</h2><h3 id="metricbeat의-system-metric-기능-활성화">MetricBeat의 system metric 기능 활성화</h3><p>MetricBeat은 몇몇 Metric 수집/전송 기능을 제공하는데, 이 예제에서는 system metric 수집 및 전송 기능을 테스트한다.</p><p><code class="language-plaintext highlighter-rouge">${설치경로}/bin/metricbeat modules enable system</code> 명령어를 통해 system metric module을 활성화한다.</p><h3 id="metricbeat-setup">MetricBeat Setup</h3><p>MetricBeat과 연결된 Kibana의 Dashboard를 초기화하는 과정이다.</p><p><code class="language-plaintext highlighter-rouge">${설치경로}/bin/metricbeat setup -e</code> 명령어를 통해 초기화 할 수 있다.</p><p>아래와 같은 로그 메시지가 발생하며 초기화되었다고 성공 메시지로 명령어가 종료된다.</p><figure class="highlight"><pre><code class="language-text" data-lang="text">2018-11-19T23:55:19.747+0900    INFO    instance/beat.go:616    Home path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Config path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Data path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/data] Logs path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/logs]
2018-11-19T23:55:19.766+0900    INFO    instance/beat.go:623    Beat UUID: d4c0cd03-35c3-4c65-b51d-222021e17837
2018-11-19T23:55:19.769+0900    INFO    [beat]  instance/beat.go:849    Beat info       {"system_info": {"beat": {"path": {"config": "/usr/lib/metricbeat-6.5.0-linux-x86_64", "data": "/usr/lib/metricbeat-6.5.0-linux-x86_64/data", "home": "/usr/lib/metricbeat-6.5.0-linux-x86_64", "logs": "/usr/lib/metricbeat-6.5.0-linux-x86_64/logs"}, "type": "metricbeat", "uuid": "d4c0cd03-35c3-4c65-b51d-222021e17837"}}}
... 생략
2018-11-19T23:55:19.826+0900    INFO    instance/beat.go:302    Setup Beat: metricbeat; Version: 6.5.0
2018-11-19T23:55:22.836+0900    INFO    add_cloud_metadata/add_cloud_metadata.go:319    add_cloud_metadata: hosting provider type not detected.
2018-11-19T23:55:22.885+0900    INFO    elasticsearch/client.go:163     Elasticsearch url: http://localhost:9200
2018-11-19T23:55:22.898+0900    INFO    [publisher]     pipeline/module.go:110  Beat name: leeyh0216-pc
2018-11-19T23:55:22.903+0900    INFO    elasticsearch/client.go:163     Elasticsearch url: http://localhost:9200
2018-11-19T23:55:22.917+0900    INFO    elasticsearch/client.go:712     Connected to Elasticsearch version 6.5.0
2018-11-19T23:55:22.933+0900    INFO    template/load.go:129    Template already exists and will not be overwritten.
Loaded index template
Loading dashboards (Kibana must be running and reachable)
2018-11-19T23:55:22.938+0900    INFO    elasticsearch/client.go:163     Elasticsearch url: http://localhost:9200
2018-11-19T23:55:22.962+0900    INFO    elasticsearch/client.go:712     Connected to Elasticsearch version 6.5.0
2018-11-19T23:55:22.967+0900    INFO    kibana/client.go:118    Kibana url: http://localhost:5601
2018-11-19T23:55:57.005+0900    INFO    instance/beat.go:741    Kibana dashboards successfully loaded.</code></pre></figure><h3 id="metricbeat-서비스-실행">MetricBeat 서비스 실행</h3><p>위의 두 과정을 통해 MetricBeat의 System 모듈과 MetricBeat과 연결된 Kibana의 Dashboard를 초기화하였다.</p><p>이제 MetricBeat을 실행할 차례이다.</p><p>아래 명령어를 통해 MetricBeat을 실행한다.</p><p><code class="language-plaintext highlighter-rouge">${설치경로}/bin/metricbeat -e</code> 명령어를 입력하면 아래와 같은 로그 메시지가 발생하며 MetricBeat이 실행된 것을 확인할 수 있다.</p><figure class="highlight"><pre><code class="language-text" data-lang="text">2018-11-19T23:57:08.793+0900    INFO    instance/beat.go:616    Home path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Config path: [/usr/lib/metricbeat-6.5.0-linux-x86_64] Data path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/data] Logs path: [/usr/lib/metricbeat-6.5.0-linux-x86_64/logs]
2018-11-19T23:57:08.796+0900    INFO    instance/beat.go:623    Beat UUID: d4c0cd03-35c3-4c65-b51d-222021e17837
2018-11-19T23:57:08.799+0900    INFO    [seccomp]       seccomp/seccomp.go:93   Syscall filter could not be installed because the kernel does not support seccomp
2018-11-19T23:57:08.816+0900    INFO    [beat]  instance/beat.go:849    Beat info       {"system_info": {"beat": {"path": {"config": "/usr/lib/metricbeat-6.5.0-linux-x86_64", "data": "/usr/lib/metricbeat-6.5.0-linux-x86_64/data", "home": "/usr/lib/metricbeat-6.5.0-linux-x86_64", "logs": "/usr/lib/metricbeat-6.5.0-linux-x86_64/logs"}, "type": "metricbeat", "uuid": "d4c0cd03-35c3-4c65-b51d-222021e17837"}}}
2018-11-19T23:57:08.817+0900    INFO    [beat]  instance/beat.go:858    Build info      {"system_info": {"build": {"commit": "ff5b9b3db49856a25b5eda133b6997f2157a4910", "libbeat": "6.5.0", "time": "2018-11-09T18:03:04.000Z", "version": "6.5.0"}}}
2018-11-19T23:57:08.818+0900    INFO    [beat]  instance/beat.go:861    Go runtime info {"system_info": {"go": {"os":"linux","arch":"amd64","max_procs":4,"version":"go1.10.3"}}}
2018-11-19T23:57:08.824+0900    INFO    [beat]  instance/beat.go:865    Host info       {"system_info": {"host": {"architecture":"x86_64","boot_time":"2018-11-16T22:41:58+09:00","containerized":true,"name":"leeyh0216-pc","ip":["169.254.103.52/16","fe80::35ce:4940:4154:6734/64","169.254.182.173/16","fe80::8595:86d3:ab93:b6ad/64","172.22.36.145/28","fe80::e0b9:fff1:14a:3de5/64","10.0.75.1/24","127.0.0.1/8","::1/128","192.168.219.103/24","fe80::f571:57f5:e305:e4ec/64","169.254.39.125/16","fe80::64b2:28fe:35ae:277d/64","169.254.189.130/16","fe80::fd70:9829:96ad:bd82/64"],"kernel_version":"4.4.0-17134-Microsoft","mac":["c4:9d:ed:8e:1f:7c","02:50:f2:00:00:01","02:15:06:8b:5d:5c","00:15:5d:db:85:04","c4:9d:ed:8e:1f:7b","c6:9d:ed:8e:1e:7a","c6:9d:ed:8e:1b:7a"],"os":{"family":"debian","platform":"ubuntu","name":"Ubuntu","version":"16.04.3 LTS (Xenial Xerus)","major":16,"minor":4,"patch":3,"codename":"xenial"},"timezone":"DST","timezone_offset_sec":32400}}}
2018-11-19T23:57:08.826+0900    INFO    [beat]  instance/beat.go:894    Process info    {"system_info": {"process": {"capabilities": {"inheritable":null,"permitted":null,"effective":null,"bounding":["chown","dac_override","dac_read_search","fowner","fsetid","kill","setgid","setuid","setpcap","linux_immutable","net_bind_service","net_broadcast","net_admin","net_raw","ipc_lock","ipc_owner","sys_module","sys_rawio","sys_chroot","sys_ptrace","sys_pacct","sys_admin","sys_boot","sys_nice","sys_resource","sys_time","sys_tty_config","mknod","lease","audit_write","audit_control","setfcap","mac_override","mac_admin","syslog","wake_alarm","block_suspend"],"ambient":null}, "cwd": "/usr/lib/metricbeat-6.5.0-linux-x86_64", "exe": "/usr/lib/metricbeat-6.5.0-linux-x86_64/metricbeat", "name": "metricbeat", "pid": 1790, "ppid": 1641, "seccomp": {"mode":""}, "start_time": "2018-11-19T23:57:07.900+0900"}}}
2018-11-19T23:57:08.827+0900    INFO    instance/beat.go:302    Setup Beat: metricbeat; Version: 6.5.0
2018-11-19T23:57:11.839+0900    INFO    add_cloud_metadata/add_cloud_metadata.go:319    add_cloud_metadata: hosting provider type not detected.
2018-11-19T23:57:11.845+0900    INFO    elasticsearch/client.go:163     Elasticsearch url: http://localhost:9200
2018-11-19T23:57:11.871+0900    INFO    [publisher]     pipeline/module.go:110  Beat name: leeyh0216-pc
2018-11-19T23:57:11.909+0900    INFO    [monitoring]    log/log.go:117  Starting metrics logging every 30s
2018-11-19T23:57:11.911+0900    INFO    instance/beat.go:424    metricbeat start running.
...생략
2018-11-19T23:57:13.116+0900    INFO    template/load.go:129    Template already exists and will not be overwritten.
2018-11-19T23:57:13.118+0900    INFO    pipeline/output.go:105  Connection to backoff(elasticsearch(http://localhost:9200)) established
2018-11-19T23:57:41.953+0900    INFO    [monitoring]    log/log.go:144  Non-zero metrics in the last 30s        {"monitoring": {"metrics": {"beat":{"cpu":{"system":{"ticks":480,"time":{"ms":484}},"total":{"ticks":680,"time":{"ms":687},"value":0},"user":{"ticks":200,"time":{"ms":203}}},"handles":{"limit":{"hard":4096,"soft":1024},"open":6},"info":{"ephemeral_id":"f91190da-ef4b-4bcd-9cc3-9b84419376fa","uptime":{"ms":33233}},"memstats":{"gc_next":6331744,"memory_alloc":5023160,"memory_total":17274296,"rss":25976832}},"libbeat":{"config":{"module":{"running":0},"reloads":1},"output":{"events":{"acked":62,"batches":3,"total":62},"read":{"bytes":1902},"type":"elasticsearch","write":{"bytes":45366}},"pipeline":{"clients":6,"events":{"active":0,"published":62,"retry":24,"total":62},"queue":{"acked":62}}},"metricbeat":{"system":{"cpu":{"events":3,"success":3},"filesystem":{"events":1,"failures":1},"fsstat":{"events":1,"failures":1},"load":{"events":3,"success":3},"memory":{"events":3,"success":3},"network":{"events":24,"success":24},"process":{"events":23,"success":23},"process_summary":{"events":3,"success":3},"uptime":{"events":1,"success":1}}},"system":{"cpu":{"cores":4},"load":{"1":0.52,"15":0.59,"5":0.58,"norm":{"1":0.13,"15":0.1475,"5":0.145}}}}}}</code></pre></figure><p>일정 시간마다 맨 아랫줄과 같은 시스템 정보를 Elastic Search로 전송하는 것을 확인할 수 있다.</p><p>Kibana의 Dashboard 메뉴를 클릭해보면 아래와 같이 여러 개의 Dashboard가 생성된 것을 확인할 수 있으며</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/elasticsearch/kibana_system_dashboard_menu.jpg" alt="Kibana System Dashboard Menu" /></p><p>System Dashboard로 들어가보면 아래와 같이 System 상태가 기록되는 것을 확인할 수 있다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/elasticsearch/kibana_system_dashboard.jpg" alt="Kibana System Dashboard" /></p><h1 id="정리">정리</h1><p>다운로드/설치만을 통해 기본 값으로 실행해서 그런지 막힘 없이 진행할 수 있었다.</p><p>대시보드의 지표들을 확인해보니 확실히 Zabbix 보다 많은 기능을 제공해주는 것 같긴 하다. 좀 더 기능적인 부분에 대해 확인해본 후 도입을 결정해야할 것 같다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/elasticsearch/'>elasticsearch</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=ElasticSearch + MetricBeat + Kibana로 서버 모니터링하기 - leeyh0216's devlog&url=https://leeyh0216.github.io/posts/elasticsearch-1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=ElasticSearch + MetricBeat + Kibana로 서버 모니터링하기 - leeyh0216's devlog&u=https://leeyh0216.github.io/posts/elasticsearch-1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=ElasticSearch + MetricBeat + Kibana로 서버 모니터링하기 - leeyh0216's devlog&url=https://leeyh0216.github.io/posts/elasticsearch-1/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ps/">ps</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/apache-spark/">apache-spark</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/apache-druid/">apache-druid</a> <a class="post-tag" href="/tags/string/">string</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/docker/">docker</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/heap-and-gc/"><div class="card-body"> <span class="timeago small" > Jul 14 <i class="unloaded">2024-07-14T17:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JVM Heap과 GC를 다른 관점에서 바라보기</h3><div class="text-muted small"><p> 개요 Garbage Collection을 검색해보면 대부분의 글이 특정 GC(CMS, G1, Z 등)의 배경이 되는 이론(ex. Generational Collection Theory)이나, 알고리즘(ex. Mark-Sweep), 튜닝 등에 대한 내용을 다루고 있다. 그리고 해당 이론에 근거하여 Heap 메모리의 구조를 설명하다보니, Heap 영역을...</p></div></div></a></div><div class="card"> <a href="/posts/protobuf_2_5_build/"><div class="card-body"> <span class="timeago small" > Mar 10 <i class="unloaded">2024-03-10T12:10:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>protobuf 2.5 빌드하기(Apple Silicon)</h3><div class="text-muted small"><p> 이 문제는 Apple Silicon(M1, M2, M3 등)에서만 발생합니다. Ubuntu나 Intel Mac에서는 발생하지 않을 수 있음을 유의하시기 바랍니다. Hadoop 3.2.2 버전을 빌드하려다보니, 아래와 같은 메시지가 발생하며 빌드에 실패하였다. 1 [ERROR] Failed to execute goal org.apache.ha...</p></div></div></a></div><div class="card"> <a href="/posts/cmu_intro_to_database_2/"><div class="card-body"> <span class="timeago small" > Dec 22, 2023 <i class="unloaded">2023-12-22T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>데이터 엔지니어를 위한 CMU Intro to Database Systems#2</h3><div class="text-muted small"><p> Lecture #10: Sorting &amp; Aggregation Algorithms 참고자료: Youtube - F2023 #10 - Sorting &amp; Aggregation Algorithms (CMU Intro to Database Systems) Query Plan SQL문을 실행하면, DBMS는 쿼리를 Compile하여 Quer...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/spark-udf-null/" class="btn btn-outline-primary" prompt="Older"><p>Spark UDF와 DataSet에서의 NULL 처리</p></a> <a href="/posts/spring-core-2/" class="btn btn-outline-primary" prompt="Newer"><p>Spring Core Technologies - The IoC Container(2)</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/username">leeyh0216</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ps/">ps</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/apache-spark/">apache spark</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/apache-druid/">apache druid</a> <a class="post-tag" href="/tags/string/">string</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/docker/">docker</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://leeyh0216.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
